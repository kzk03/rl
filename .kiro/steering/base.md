---
inclusion: always
---

# Kazoo プロジェクト開発ガイドライン

## 言語設定

- 開発者は日本人のため、すべての出力、仕様書、コメント、ドキュメントは日本語で記述してください
- コード内のコメントも日本語で記述してください
- エラーメッセージやログ出力も可能な限り日本語で表示してください

## コーディング規約

### Python コードスタイル

- **命名規則**: snake_case を使用（例: `train_gat.py`, `evaluate_models.py`）
- **インポート順序**: 標準ライブラリ → サードパーティ → プロジェクト内モジュール
- **型ヒント**: 可能な限り型アノテーションを使用
- **docstring**: 関数とクラスには日本語で docstring を記述

```python
def train_model(config: Dict[str, Any]) -> torch.nn.Module:
    """
    モデルを訓練する関数

    Args:
        config: 訓練設定辞書

    Returns:
        訓練済みモデル
    """
    pass
```

### ファイル・ディレクトリ命名

- **スクリプト**: 機能を表す動詞から始める（例: `train_`, `evaluate_`, `generate_`）
- **設定ファイル**: 環境や用途を明記（例: `base_training.yaml`, `dev_profiles_test_2022.yaml`）
- **データファイル**: データ種別と用途を含める（例: `expert_trajectories_training.pkl`）

## 開発原則

### 再現性の確保

- すべての実験は YAML 設定ファイルで制御可能にする
- ランダムシードを設定し、結果の再現性を保証する
- モデルとデータセットのバージョン管理を行う

### 時系列データの取り扱い

- **重要**: 必ず時系列分割を使用（古いデータで訓練、新しいデータでテスト）
- 未来のデータを使った訓練は厳禁
- データリークを防ぐため、前処理段階でも時系列を考慮する

### エラーハンドリング

- 例外処理は具体的で日本語のメッセージを含める
- ログレベルを適切に設定（DEBUG, INFO, WARNING, ERROR）
- 失敗時の状態復旧を考慮した設計にする

```python
try:
    model = load_model(model_path)
except FileNotFoundError:
    logger.error(f"モデルファイルが見つかりません: {model_path}")
    raise
except Exception as e:
    logger.error(f"モデル読み込み中にエラーが発生しました: {str(e)}")
    raise
```

## 設定管理

### YAML 設定ファイル

- 階層構造を使用し、共通設定は base から継承
- 環境固有の設定は明確に分離
- コメントで設定項目の意味を日本語で説明

### 実験管理

- 実験結果は `outputs/` ディレクトリに保存
- タイムスタンプ付きのディレクトリで実験を管理
- 実験設定と結果を紐付けて保存

## パフォーマンス考慮事項

### メモリ管理

- 大きなデータセットはバッチ処理で扱う
- 不要なオブジェクトは明示的に削除
- GPU メモリ使用量を監視

### 並列処理

- CPU 集約的なタスクは multiprocessing を活用
- GPU 訓練時は適切なバッチサイズを設定
- I/O 待機時間を最小化

## セキュリティ

- 機密情報は環境変数や `.env` ファイルで管理
- GitHub トークンや API キーをコードに直接記述しない
- データファイルに個人情報が含まれていないか確認
