# ãƒ­ã‚°ãƒ»ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

# ãƒ­ã‚°è¨­å®š
logging:
  # åŸºæœ¬è¨­å®š
  level: "INFO" # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "text" # text, json

  # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›è¨­å®š
  file_logging:
    enabled: true
    base_dir: "logs"

    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®š
    files:
      main:
        filename: "gerrit_retention.log"
        level: "INFO"
        rotation: "10 MB"
        retention: "7 days"
        compression: "gz"

      error:
        filename: "error.log"
        level: "ERROR"
        rotation: "5 MB"
        retention: "14 days"
        compression: "gz"

      debug:
        filename: "debug.log"
        level: "DEBUG"
        rotation: "20 MB"
        retention: "3 days"
        compression: "gz"

      performance:
        filename: "performance.log"
        level: "INFO"
        rotation: "10 MB"
        retention: "7 days"
        compression: "gz"

      alerts:
        filename: "alerts.log"
        level: "WARNING"
        rotation: "5 MB"
        retention: "30 days"
        compression: "gz"

  # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›è¨­å®š
  console_logging:
    enabled: true
    level: "INFO"
    colorize: true

  # æ§‹é€ åŒ–ãƒ­ã‚°è¨­å®š
  structured_logging:
    enabled: true
    include_fields:
      - "timestamp"
      - "level"
      - "logger_name"
      - "function_name"
      - "line_number"
      - "message"
      - "module"
      - "thread_id"
      - "process_id"

    # è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    context_fields:
      - "user_id"
      - "session_id"
      - "request_id"
      - "correlation_id"

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–è¨­å®š
performance_monitoring:
  # åŸºæœ¬è¨­å®š
  enabled: true
  metrics_retention_hours: 168 # 7æ—¥é–“

  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†è¨­å®š
  metrics_collection:
    # ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹
    system_metrics:
      enabled: true
      interval_seconds: 60
      metrics:
        - "cpu_usage"
        - "memory_usage"
        - "disk_usage"
        - "network_io"
        - "disk_io"

    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒˆãƒªã‚¯ã‚¹
    application_metrics:
      enabled: true
      metrics:
        - "execution_time"
        - "error_rate"
        - "throughput"
        - "response_time"
        - "queue_size"
        - "active_connections"

    # æ©Ÿæ¢°å­¦ç¿’ãƒ¡ãƒˆãƒªã‚¯ã‚¹
    ml_metrics:
      enabled: true
      metrics:
        - "model_accuracy"
        - "prediction_latency"
        - "training_time"
        - "inference_time"
        - "model_size"
        - "feature_importance"

  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›è¨­å®š
  metrics_output:
    # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
    file_output:
      enabled: true
      filename: "metrics.jsonl"
      rotation: "daily"
      retention: "30 days"

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    console_output:
      enabled: false
      interval_seconds: 300 # 5åˆ†é–“éš”

    # å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº
    external_systems:
      prometheus:
        enabled: false
        endpoint: "http://localhost:9090"
        push_interval_seconds: 30

      grafana:
        enabled: false
        dashboard_url: "http://localhost:3000"

      elasticsearch:
        enabled: false
        host: "localhost"
        port: 9200
        index: "gerrit-retention-metrics"

# ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥è¨­å®š
alerting:
  # åŸºæœ¬è¨­å®š
  enabled: true

  # ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«
  rules:
    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆ
    performance_alerts:
      slow_execution:
        condition: "execution_time > 30"
        severity: "warning"
        message: "å®Ÿè¡Œæ™‚é–“ãŒ30ç§’ã‚’è¶…ãˆã¾ã—ãŸ: {function_name}"
        cooldown_minutes: 5

      very_slow_execution:
        condition: "execution_time > 120"
        severity: "error"
        message: "å®Ÿè¡Œæ™‚é–“ãŒ2åˆ†ã‚’è¶…ãˆã¾ã—ãŸ: {function_name}"
        cooldown_minutes: 10

      high_error_rate:
        condition: "error_rate > 0.1"
        severity: "error"
        message: "ã‚¨ãƒ©ãƒ¼ç‡ãŒ10%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 15

      critical_error_rate:
        condition: "error_rate > 0.25"
        severity: "critical"
        message: "ã‚¨ãƒ©ãƒ¼ç‡ãŒ25%ã‚’è¶…ãˆã¾ã—ãŸ - ç·Šæ€¥å¯¾å¿œãŒå¿…è¦"
        cooldown_minutes: 5

    # ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆ
    system_alerts:
      high_cpu_usage:
        condition: "cpu_usage > 0.8"
        severity: "warning"
        message: "CPUä½¿ç”¨ç‡ãŒ80%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 5

      critical_cpu_usage:
        condition: "cpu_usage > 0.95"
        severity: "critical"
        message: "CPUä½¿ç”¨ç‡ãŒ95%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 2

      high_memory_usage:
        condition: "memory_usage > 0.8"
        severity: "warning"
        message: "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ80%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 5

      critical_memory_usage:
        condition: "memory_usage > 0.95"
        severity: "critical"
        message: "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ95%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 2

      high_disk_usage:
        condition: "disk_usage > 0.9"
        severity: "warning"
        message: "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ãŒ90%ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 30

    # æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ©ãƒ¼ãƒˆ
    ml_alerts:
      model_accuracy_drop:
        condition: "model_accuracy < 0.7"
        severity: "warning"
        message: "ãƒ¢ãƒ‡ãƒ«ç²¾åº¦ãŒ70%ã‚’ä¸‹å›ã‚Šã¾ã—ãŸ"
        cooldown_minutes: 60

      prediction_latency_high:
        condition: "prediction_latency > 5"
        severity: "warning"
        message: "äºˆæ¸¬ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒ5ç§’ã‚’è¶…ãˆã¾ã—ãŸ"
        cooldown_minutes: 10

      training_failure:
        condition: "training_status == 'failed'"
        severity: "error"
        message: "ãƒ¢ãƒ‡ãƒ«è¨“ç·´ãŒå¤±æ•—ã—ã¾ã—ãŸ"
        cooldown_minutes: 30

  # é€šçŸ¥ãƒãƒ£ãƒãƒ«
  notification_channels:
    # ãƒ•ã‚¡ã‚¤ãƒ«é€šçŸ¥
    file:
      enabled: true
      filename: "alerts.log"
      format: "json"

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«é€šçŸ¥
    console:
      enabled: true
      color_coding: true
      severity_icons:
        info: "â„¹ï¸"
        warning: "âš ï¸"
        error: "âŒ"
        critical: "ğŸš¨"

    # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
    email:
      enabled: false
      smtp_server: "smtp.example.com"
      smtp_port: 587
      username: "${EMAIL_USERNAME}"
      password: "${EMAIL_PASSWORD}"
      from_address: "alerts@example.com"
      to_addresses:
        - "admin@example.com"
        - "devops@example.com"

      # é‡è¦åº¦åˆ¥è¨­å®š
      severity_settings:
        critical:
          enabled: true
          subject_prefix: "[CRITICAL]"
        error:
          enabled: true
          subject_prefix: "[ERROR]"
        warning:
          enabled: false
        info:
          enabled: false

    # Slacké€šçŸ¥
    slack:
      enabled: false
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#alerts"
      username: "GerritRetentionBot"

      # é‡è¦åº¦åˆ¥è¨­å®š
      severity_settings:
        critical:
          enabled: true
          color: "danger"
        error:
          enabled: true
          color: "warning"
        warning:
          enabled: true
          color: "warning"
        info:
          enabled: false

    # Discordé€šçŸ¥
    discord:
      enabled: false
      webhook_url: "${DISCORD_WEBHOOK_URL}"

    # PagerDutyé€šçŸ¥
    pagerduty:
      enabled: false
      integration_key: "${PAGERDUTY_INTEGRATION_KEY}"
      severity_mapping:
        critical: "critical"
        error: "error"
        warning: "warning"
        info: "info"

# ãƒ­ã‚°åˆ†æè¨­å®š
log_analysis:
  # è‡ªå‹•åˆ†æ
  automated_analysis:
    enabled: true
    analysis_interval_hours: 24

    # åˆ†æé …ç›®
    analysis_items:
      - "error_patterns"
      - "performance_trends"
      - "usage_statistics"
      - "anomaly_detection"

  # ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  report_generation:
    enabled: true
    output_dir: "outputs/log_reports"
    formats: ["html", "pdf", "json"]

    # ãƒ¬ãƒãƒ¼ãƒˆç¨®é¡
    reports:
      daily_summary:
        enabled: true
        schedule: "daily"
        include_sections:
          - "error_summary"
          - "performance_summary"
          - "alert_summary"

      weekly_analysis:
        enabled: true
        schedule: "weekly"
        include_sections:
          - "trend_analysis"
          - "performance_analysis"
          - "error_analysis"
          - "recommendations"

      monthly_report:
        enabled: true
        schedule: "monthly"
        include_sections:
          - "comprehensive_analysis"
          - "capacity_planning"
          - "optimization_recommendations"

# ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
debugging:
  # ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
  debug_mode:
    enabled: false # æœ¬ç•ªç’°å¢ƒã§ã¯ç„¡åŠ¹
    verbose_logging: true
    stack_trace_logging: true

  # ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°
  tracing:
    enabled: false
    trace_sampling_rate: 0.1
    trace_export_format: "jaeger"

  # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
  profiling:
    enabled: false
    profiler_type: "cProfile"
    output_dir: "outputs/profiling"
