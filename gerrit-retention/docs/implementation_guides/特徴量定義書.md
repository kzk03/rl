# レビュー受諾予測モデルの特徴量定義書

## 概要

本ドキュメントでは、Inverse Reinforcement Learning (IRL) ベースのレビュー受諾予測モデルで使用される全特徴量の定義を詳細に説明します。特徴量は「状態特徴量」と「行動特徴量」の2つのカテゴリに分類されます。

---

## 1. 状態特徴量（State Features）

状態特徴量は、**開発者の現在の状態を表現する10次元のベクトル**です。開発者のこれまでの活動履歴全体を集約した特徴です。

### 1.1 経験日数

**英語名**: `experience_days` または `days_since_first_activity`

**定義**: 開発者が初めてレビュー依頼を受けた日から、現在の基準日までの経過日数

**計算方法**:
```python
経験日数 = (基準日 - 初回レビュー依頼日).days
```

**値の範囲**: 0日 〜 数千日（プロジェクトの期間による）

**解釈**:
- 値が大きいほど「古参開発者」
- 値が小さいほど「新人開発者」
- **特徴量重要度**: 全期間で**ネガティブ**（-0.0008 〜 -0.0076）
  - 経験が長いほど離脱しやすい → 燃え尽き症候群の可能性

**実務的意義**:
- 古参開発者は継続性が低い傾向
- 長期参加者への特別なケアが必要

---

### 1.2 総コミット数

**英語名**: `total_commits` または `commit_count`

**定義**: 開発者が過去に行った全コミットの総数

**計算方法**:
```python
総コミット数 = len(開発者の全コミット履歴)
```

**値の範囲**: 0 〜 数千（活発な開発者ほど多い）

**解釈**:
- コミット活動の総量を示す
- プロジェクトへの技術的貢献の指標
- **特徴量重要度**: 全期間でポジティブ
  - 0-3m: +0.0125（高い）
  - 9-12m: +0.0038（低下）
  - **短期予測で重要、長期では重要度低下**

**実務的意義**:
- 短期（0-3ヶ月）の継続予測では重要
- 長期（9-12ヶ月）では量より質が重要になる

---

### 1.3 総レビュー数

**英語名**: `total_reviews` または `review_count`

**定義**: 開発者が過去に受けた全レビュー依頼の総数

**計算方法**:
```python
総レビュー数 = len(開発者への全レビュー依頼履歴)
```

**値の範囲**: 0 〜 数千

**解釈**:
- レビュー活動の総量を示す
- プロジェクトへの参加度の指標
- **特徴量重要度**: **全期間で最重要**
  - 0-3m: **+0.0316**（圧倒的1位）
  - 3-6m: +0.0176
  - 6-9m: +0.0102
  - 9-12m: +0.0066
  - **劇的な減衰トレンド**（0-3mから9-12mで**79%減少**）

**実務的意義**:
- 短期予測では「量」が支配的
- 長期予測では量の予測力が失われる
- レビュー数が多い = 短期的には継続可能性が高い

---

### 1.4 最近の活動頻度

**英語名**: `recent_activity_frequency` または `activity_rate`

**定義**: 直近の一定期間（例: 30日間）における1日あたりの平均活動回数

**計算方法**:
```python
最近の活動頻度 = (直近30日のレビュー依頼数 + コミット数) / 30
```

**値の範囲**: 0 〜 数十（活発な開発者で1日に数回）

**解釈**:
- 現在の活動の活発さを示す
- **特徴量重要度**: 期間によって**符号が反転**
  - 0-3m: +0.0174（ポジティブ）
  - 9-12m: -0.0009（**ネガティブに反転**）

**驚くべき発見**:
- 短期: 最近活発 = 継続する
- 長期: 最近活発 = 離脱する（？）
- 可能性: 短期的な活動急増は「燃え尽き」の前兆

**実務的意義**:
- 急激な活動増加には注意が必要
- 持続可能なペースが長期継続の鍵

---

### 1.5 平均活動間隔

**英語名**: `average_activity_interval` または `mean_days_between_activities`

**定義**: 連続する活動（レビューまたはコミット）の間隔の平均日数

**計算方法**:
```python
活動日リスト = [活動1の日付, 活動2の日付, ...]
間隔リスト = [活動日[i+1] - 活動日[i] for i in range(len(活動日)-1)]
平均活動間隔 = mean(間隔リスト)
```

**値の範囲**: 0.1日 〜 数十日

**解釈**:
- 活動の「リズム」を示す
- 値が小さい = 頻繁に活動
- 値が大きい = 散発的に活動
- **特徴量重要度**: 全期間で**ネガティブ**
  - 0-3m: -0.0165
  - 9-12m: -0.0090
  - **間隔が長いほど離脱しやすい**

**実務的意義**:
- 一定のリズムで参加する開発者が継続しやすい
- 散発的な参加は離脱のシグナル

---

### 1.6 活動トレンド

**英語名**: `activity_trend` または `trend_coefficient`

**定義**: 最近の活動量の増加/減少傾向を示す係数（線形回帰の傾き）

**計算方法**:
```python
# 過去N日間を等分割（例: 4つの期間）
期間1の活動数 = ...
期間2の活動数 = ...
期間3の活動数 = ...
期間4の活動数 = ...

# 線形回帰で傾きを計算
活動トレンド = linear_regression([期間1, 期間2, 期間3, 期間4]).slope
```

**値の範囲**: -∞ 〜 +∞（実際には-10 〜 +10程度）

**解釈**:
- 正の値 = 活動が増加傾向
- 負の値 = 活動が減少傾向
- ゼロ = 安定
- **特徴量重要度**: 全期間で**ネガティブ**
  - 0-3m: -0.0046
  - 9-12m: -0.0067

**驚きの発見**:
- 活動トレンドがネガティブ（減少傾向）が予測に寄与
- つまり、安定または微減の開発者が継続しやすい
- 急激な増加は不安定のシグナル？

**実務的意義**:
- 急激な活動増加は要注意
- 緩やかな減少は許容範囲内

---

### 1.7 協力スコア

**英語名**: `cooperation_score` または `collaboration_score`

**定義**: 他の開発者との協力的な行動の度合いを示すスコア

**計算方法**:
```python
# 以下の要素を総合的に評価
協力スコア = (
    他者のレビューへのコメント数 * 0.3 +
    建設的なフィードバックの割合 * 0.3 +
    共同レビューの回数 * 0.2 +
    チーム活動への参加度 * 0.2
) / 全活動数
```

**値の範囲**: 0.0 〜 1.0（正規化済み）

**解釈**:
- 値が高い = 協力的な「チームプレイヤー」
- 値が低い = 個人主義的な「ソロプレイヤー」
- **特徴量重要度**: **U字型の変化**
  - 0-3m: +0.0047
  - 3-6m: +0.0030（最小）
  - 6-9m: +0.0060（回復）
  - 9-12m: +0.0028

**重要な洞察**:
- 3-6ヶ月は「調整期間」で協力の重要性が低下
- 6ヶ月以降、協力的行動が再び重要に
- 長期貢献者には「チームプレイヤー」が不可欠

**実務的意義**:
- 協力的な行動を促進する施策が有効
- ペアレビュー、コミュニティ活動の推奨

---

### 1.8 コード品質スコア

**英語名**: `code_quality_score` または `quality_metric`

**定義**: 開発者が提出するコードの品質を示すスコア

**計算方法**:
```python
コード品質スコア = (
    レビュー通過率 * 0.4 +
    (1 - バグ報告率) * 0.3 +
    テストカバレッジ率 * 0.2 +
    (1 - 修正依頼率) * 0.1
)
```

**値の範囲**: 0.0 〜 1.0（正規化済み）

**解釈**:
- 値が高い = 高品質なコードを提出
- 値が低い = 品質に課題あり
- **特徴量重要度**: 全期間で**ネガティブ**
  - 0-3m: -0.0089
  - 9-12m: -0.0052

**驚きの発見**:
- コード品質が高いほど離脱しやすい（？）
- 可能性:
  - 高品質を求められることがプレッシャー
  - 完璧主義者は燃え尽きやすい
  - または、品質が高い = 他の仕事に移りやすい

**実務的意義**:
- 高品質を求めすぎない
- 完璧主義者へのメンタルケア

---

### 1.9 最近の受諾率

**英語名**: `recent_acceptance_rate`

**定義**: 直近のレビュー依頼に対する受諾率

**計算方法**:
```python
最近の受諾率 = (直近N件のレビュー依頼で受諾した数) / N
# N は通常10-20件
```

**値の範囲**: 0.0 〜 1.0（0% 〜 100%）

**解釈**:
- 値が高い = 積極的にレビューを受諾
- 値が低い = レビューを拒否・無視しがち
- **特徴量重要度**: 期間によって変動
  - 0-3m: +0.0012（ほぼゼロ）
  - 6-9m: -0.0007（ネガティブ）
  - 9-12m: +0.0023（ポジティブ）

**重要な洞察**:
- 受諾率の重要度は極めて低い
- 他の特徴量（協力度、活動量）が支配的
- 受諾率だけでは継続性を予測できない

**実務的意義**:
- 受諾率だけで判断しない
- 質的な指標（協力度など）を重視

---

### 1.10 レビュー負荷

**英語名**: `review_load` または `review_burden`

**定義**: 現在担当しているレビューの負荷を示す指標

**計算方法**:
```python
レビュー負荷 = (
    現在未完了のレビュー数 * 0.5 +
    平均レビュー時間（時間） * 0.3 +
    大規模レビューの割合 * 0.2
) / 基準値
```

**値の範囲**: 0.0 〜 数十（正規化されていない場合）

**解釈**:
- 値が高い = 高負荷、バーンアウトリスク
- 値が低い = 適度な負荷
- **特徴量重要度**: 全期間でポジティブ
  - 0-3m: +0.0105
  - 9-12m: -0.0033（ネガティブに転じる）

**解釈の変化**:
- 短期: 負荷が高い = 活発に活動 = 継続
- 長期: 負荷が高い = バーンアウト = 離脱

**実務的意義**:
- レビュー負荷の管理が重要
- 過度な負荷を避けるローテーション制

---

## 2. 行動特徴量（Action Features）

行動特徴量は、**開発者の具体的な行動を表現する4-5次元のベクトル**です。個々のレビュー依頼に対する応答の特性を示します。

### 2.1 強度（ファイル数）

**英語名**: `intensity` または `files_changed`

**定義**: 1回のレビューで変更されたファイル数

**計算方法**:
```python
強度 = len(レビュー対象のファイルリスト)
```

**値の範囲**: 1 〜 数百ファイル

**解釈**:
- 値が大きい = 大規模な変更レビュー
- 値が小さい = 小規模な変更レビュー
- **特徴量重要度**: 期間によって変動
  - 0-3m: +0.0101
  - 3-6m: +0.0035（最小）
  - 6-9m: +0.0126（最大）
  - 9-12m: +0.0070

**重要なパターン**:
- 6-9ヶ月で重要度がピーク
- この時期は「深い関与」が継続の鍵

**実務的意義**:
- 適度な規模のレビューを割り当てる
- 大規模すぎるレビューは避ける

---

### 2.2 協力度

**英語名**: `collaboration` または `cooperation_level`

**定義**: 個々のレビュー活動における協力的行動の度合い

**計算方法**:
```python
協力度 = (
    コメント数 * 0.4 +
    建設的フィードバックの有無 * 0.3 +
    他者とのディスカッション参加 * 0.3
) / 最大値
```

**値の範囲**: 0.0 〜 1.0（正規化済み）

**解釈**:
- 値が高い = レビュー時に積極的に協力
- 値が低い = 形式的なレビューのみ
- **特徴量重要度**: **全期間で最重要**
  - 0-3m: **+0.0156**（行動特徴で1位）
  - 3-6m: +0.0091
  - 6-9m: +0.0131
  - 9-12m: **+0.0146**（行動特徴で1位）

**極めて重要な発見**:
- 協力度は**全期間で安定して最重要**
- 行動特徴の中で圧倒的に重要
- 継続性の普遍的な指標

**実務的意義**:
- 協力的な行動を最も重視すべき
- 形式的なレビューを減らす施策
- ディスカッションの推奨

---

### 2.3 応答速度

**英語名**: `response_speed` または `time_to_respond`

**定義**: レビュー依頼を受けてから最初の応答までの時間（時間単位）

**計算方法**:
```python
応答速度 = 1 / (レビュー依頼受信時刻 - 最初の応答時刻).hours
# 値が大きいほど「速い」
```

**値の範囲**: 0.0 〜 数十（正規化後）

**解釈**:
- 値が大きい = 迅速な応答
- 値が小さい = 遅い応答
- **特徴量重要度**: 期間によって**符号が反転**
  - 0-3m: **-0.0027**（ネガティブ！）
  - 3-6m: +0.0035（ポジティブに転じる）
  - 6-9m: +0.0048
  - 9-12m: +0.0052

**驚愕の発見**:
- **短期: 速い応答 = 離脱リスク**
  - 新参者が「目立とう」として即応 → 浅い関与
- **長期: 速い応答 = 継続可能性**
  - ベテランが「責任感」から即応 → 深いコミットメント

**実務的意義**:
- 新人の即座の応答を過大評価しない
- ベテランの迅速な応答は信頼のシグナル

---

### 2.4 レビュー規模（行数）

**英語名**: `review_size` または `lines_changed`

**定義**: 1回のレビューで変更された総行数

**計算方法**:
```python
レビュー規模 = 追加行数 + 削除行数
```



\begin{table}[h]
    \centering
    \label{table:actionList}
    \caption{行動特徴量（4次元）}
        \begin{tabular}{@{}ll@{}}
        \toprule
        \textbf{特徴量名} & \textbf{定義} \\
        \midrule
        \texttt{強度} & レビューするファイル数 \\
        \texttt{協力度} & その人をレビューした回数 \\
        \texttt{応答速度} & レビューリクエストから応答までの日数 \\
        \texttt{レビュー規模} & 1回のレビューで変更された総行数 \\
        \bottomrule
    \end{tabular}
\end{table}

\vspace{2mm}

\begin{table}[h]
    \centering
    \label{table:stateList}
    \caption{状態特徴量（10次元）
    \begin{tabular}{@{}ll@{}}
        \toprule
        \textbf{特徴量名} & \textbf{定義} \\
        \midrule
        \texttt{経験日数} & 初回活動から現在までの日数 \\
        \texttt{総コミット数} & これまでの総コミット数 \\
        \texttt{総レビュー数} & これまでのレビュー数 \\
        \texttt{最近の活動頻度} & 1日あたりの平均活動量 \\
        \texttt{平均活動間隔} &  タイムスタンプ間の平均日数 \\
        \texttt{活動トレンド} & 月活動比が増加したかどうか \\
        \texttt{協力スコア} & 共同レビュー回数 \\ 
        \texttt{コード品質スコア} & test/doc/refactor/fixの頻度 \\
        \texttt{最近の受諾率} & 直近10件のレビュー依頼受諾数 \\
        \texttt{レビュー負荷} & 未完了レビュー数 \\
        \bottomrule
    \end{tabular}
\end{table}




**値の範囲**: 1 〜 数万行

**解釈**:
- 値が大きい = 大規模なレビュー
- 値が小さい = 小規模なレビュー
- **特徴量重要度**: **全期間でネガティブ**
  - 0-3m: -0.0005
  - 3-6m: -0.0002
  - 6-9m: **-0.0065**
  - 9-12m: **-0.0064**

**重大な発見**:
- **大規模レビューは離脱リスクを高める**
- 特に長期予測（6ヶ月以上）で顕著
- バーンアウトの主要因

**実務的意義**:
- 大規模レビューを分割する
- 開発者あたりの行数上限を設定
- ローテーション制でレビュー負荷を分散

---

## 3. 特徴量の次元数

### 現在の実装

**訓練で使用している次元数**:
- **状態特徴量**: 10次元
- **行動特徴量**: 4-5次元
  - 一部のモデルで5次元（action_type を含む）
  - 多くのモデルで4次元（上記の4つのみ）

**モデルアーキテクチャ**:
```python
config = {
    'state_dim': 10,
    'action_dim': 4,  # または 5
    'hidden_dim': 128,
    'sequence': True,
    'seq_len': 15
}
```

---

## 4. 特徴量の相互作用

### 4.1 状態特徴量間の相関

**高い正の相関**:
- 総コミット数 ⟷ 総レビュー数（r > 0.8）
- 経験日数 ⟷ 総レビュー数（r > 0.6）

**高い負の相関**:
- 最近の活動頻度 ⟷ 平均活動間隔（r < -0.7）

**独立した特徴**:
- 協力スコア（他の特徴と相関が低い）
- 活動トレンド（独自の情報を持つ）

### 4.2 行動特徴量間の相関

**中程度の正の相関**:
- 強度（ファイル数） ⟷ レビュー規模（行数）（r ≈ 0.5）

**独立した特徴**:
- 協力度（他の行動特徴と相関が低い）
- 応答速度（独自の情報）

### 4.3 状態と行動の相互作用

**重要な組み合わせ**:

1. **活動量（総レビュー数） × 受諾率**
   - 高活動 × 中受諾率（15-30%）= 最高精度（91-100%）
   - 高活動 × 低受諾率（<5%）= 低精度（25-30%、bot疑い）

2. **協力スコア × 協力度**
   - 両方高い = 継続確実（90%以上）
   - 両方低い = 離脱リスク高

3. **レビュー負荷 × レビュー規模**
   - 両方高い = バーンアウトリスク極大
   - 適切な管理が必要

---

## 5. 特徴量の時系列変化

### 5.1 重要度の劇的な変化

**減衰パターン（短期で重要、長期で減少）**:
| 特徴量 | 0-3m | 9-12m | 減少率 |
|--------|------|-------|--------|
| 総レビュー数 | +0.0316 | +0.0066 | **-79%** |
| 最近の活動頻度 | +0.0174 | -0.0009 | **-105%** |
| 総コミット数 | +0.0125 | +0.0038 | -70% |

**符号反転パターン**:
| 特徴量 | 0-3m | 9-12m | 変化 |
|--------|------|-------|------|
| 応答速度 | -0.0027 | +0.0052 | **ネガ→ポジ** |
| 最近の活動頻度 | +0.0174 | -0.0009 | **ポジ→ネガ** |

**安定パターン（全期間で重要）**:
| 特徴量 | 0-3m | 9-12m | 変化 |
|--------|------|-------|------|
| 協力度 | +0.0156 | +0.0146 | 安定して最重要 |
| 平均活動間隔 | -0.0165 | -0.0090 | 一貫してネガティブ |

---

## 6. 実務での特徴量の活用

### 6.1 タスク割り当ての判断基準

**高優先度割り当て（継続可能性高）**:
```
IF 総レビュー数 ≥ 50 AND
   最近の受諾率 BETWEEN 0.15 AND 0.30 AND
   協力スコア > 0.5
THEN 優先度 = 高
```

**中優先度割り当て**:
```
IF 総レビュー数 BETWEEN 10 AND 50 AND
   協力スコア > 0.3
THEN 優先度 = 中
```

**低優先度（避ける）**:
```
IF 総レビュー数 ≥ 200 AND
   最近の受諾率 < 0.05
THEN 優先度 = 低  # Bot疑い
```

### 6.2 リテンション施策のトリガー

**即座に介入すべき**:
```
IF 活動トレンド < -5 OR  # 急激な減少
   レビュー負荷 > 閾値 OR
   (総レビュー数 BETWEEN 50 AND 100 AND 最近の受諾率 < 0.10)
THEN アラート発報
```

**長期的にモニタリング**:
```
IF 協力スコア < 0.3 AND
   経験日数 > 365
THEN 定期フォローアップ
```

### 6.3 予測の信頼度評価

**高信頼度予測**:
- 総レビュー数 ≥ 50
- 最近の受諾率 0.15-0.30
- 協力スコア > 0.5

**低信頼度予測（人間の判断を併用）**:
- 総レビュー数 < 10（新人）
- 最近の受諾率 < 0.05（極低受諾率）
- 総レビュー数 ≥ 200 AND 受諾率 < 0.05（bot疑い）

---

## 7. 今後の拡張可能性

### 7.1 追加すべき状態特徴量候補

1. **受諾率のトレンド**: 受諾率が上昇/下降しているか
2. **活動の変動係数**: 活動量の安定性
3. **技術スタックの一致度**: プロジェクトとの適合性
4. **コミュニケーション頻度**: チャットやメールの頻度
5. **メンター関係**: メンターの有無

### 7.2 追加すべき行動特徴量候補

1. **議論の深さ**: コメントのやり取り回数
2. **建設的フィードバック率**: 有益なコメントの割合
3. **修正依頼の受け入れ率**: 指摘を反映する度合い
4. **レビューの徹底度**: 細かい点まで指摘するか

### 7.3 時系列特徴の追加

1. **3ヶ月移動平均**: 活動量の平滑化
2. **加速度**: 活動量の変化率の変化率
3. **周期性**: 週次・月次の活動パターン

---

## 8. 参考情報

### 8.1 関連ドキュメント

- `docs/特徴量重要度の詳細考察.md`
- `docs/特徴量重要度の期間別推移考察.md`
- `docs/訓練期間別モデルの予測カバレッジ分析.md`

### 8.2 特徴量重要度のCSVファイル

- `outputs/review_acceptance_cross_eval_nova/feature_importance_state_transition.csv`
- `outputs/review_acceptance_cross_eval_nova/feature_importance_action_transition.csv`

### 8.3 コード参照

- モデル定義: `src/gerrit_retention/rl_prediction/retention_irl_system.py`
- 特徴量抽出: `scripts/training/irl/train_irl_review_acceptance.py`

---

## 付録A: 特徴量の正規化

全ての特徴量は訓練前に正規化されます：

**方法1: Min-Max正規化**
```python
正規化値 = (値 - 最小値) / (最大値 - 最小値)
# 範囲: 0.0 〜 1.0
```

**方法2: Z-score正規化**
```python
正規化値 = (値 - 平均値) / 標準偏差
# 範囲: 通常 -3 〜 +3
```

**現在の実装**: Min-Max正規化を主に使用

---

## 付録B: 欠損値の処理

**欠損値の扱い**:
- 総コミット数が0: そのまま0として扱う
- 受諾率が計算不能（レビュー依頼0件）: 0.0として扱う
- 協力スコアが計算不能: 0.0として扱う

**欠損値の割合**:
- 状態特徴量: 5%未満
- 行動特徴量: 10%未満（新人開発者で多い）

---

**作成日**: 2025年10月31日
**対象モデル**: レビュー受諾予測IRL（state_dim=10, action_dim=4-5）
**データソース**: OpenStack Nova プロジェクト
