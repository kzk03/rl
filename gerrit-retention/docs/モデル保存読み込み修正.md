# ãƒ¢ãƒ‡ãƒ«ä¿å­˜/èª­ã¿è¾¼ã¿ã®ä¿®æ­£

## ğŸ› å•é¡Œã®åŸå› 

### ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

**åŒã˜è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãªã®ã«äºˆæ¸¬çµæœãŒå…¨ãç•°ãªã‚‹**ï¼š

| é …ç›® | è¨“ç·´ç›´å¾Œ | ãƒ¢ãƒ‡ãƒ«å†èª­ã¿è¾¼ã¿å¾Œ |
|------|---------|-------------------|
| äºˆæ¸¬ç¢ºç‡ç¯„å›² | 0.01-0.82 | 0.471-0.473 |
| æ¨™æº–åå·® | 0.25 | 0.0004 |
| Precision | 0.92 | 0.27 |
| Recall | 0.52 | 1.00 |

### æ ¹æœ¬åŸå› 

#### 1. ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿ã®èª¤ã‚Š

```python
# ä¿®æ­£å‰ï¼ˆé–“é•ã„ï¼‰
irl_system = RetentionIRLSystem(config)  # æ–°è¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
irl_system.load_model(args.model)  # ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã ãŒè¿”ã‚Šå€¤ã‚’ä½¿ã£ã¦ã„ãªã„
# â†’ æ–°è¦ä½œæˆã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã„ç¶šã‘ã‚‹ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„ï¼‰

# ä¿®æ­£å¾Œï¼ˆæ­£ã—ã„ï¼‰
irl_system = RetentionIRLSystem.load_model(args.model)  # ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”ã‚Šå€¤ã‚’ä½¿ã†
# â†’ èª­ã¿è¾¼ã¾ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æŒã¤ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ã†
```

#### 2. ãƒ¢ãƒ‡ãƒ«ä¿å­˜æ–¹æ³•ã®æ”¹å–„

```python
# ä¿®æ­£å‰
torch.save(irl_system.network.state_dict(), model_path)
# â†’ state_dict ã®ã¿ä¿å­˜ï¼ˆconfig ãŒä¿å­˜ã•ã‚Œãªã„ï¼‰

# ä¿®æ­£å¾Œ
irl_system.save_model(str(model_path))
# â†’ state_dict + optimizer + config ã‚’ä¿å­˜
```

---

## âœ… ä¿®æ­£å†…å®¹

### ä¿®æ­£1: ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/training/irl/train_irl_sliding_window.py`

```python
# Line 464
# ä¿®æ­£å‰
irl_system = RetentionIRLSystem(config)
irl_system.load_model(args.model)

# ä¿®æ­£å¾Œ
irl_system = RetentionIRLSystem.load_model(args.model)
```

### ä¿®æ­£2: ãƒ¢ãƒ‡ãƒ«ä¿å­˜

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/training/irl/train_irl_sliding_window.py`

```python
# Line 491
# ä¿®æ­£å‰
torch.save(irl_system.network.state_dict(), model_path)

# ä¿®æ­£å¾Œ
irl_system.save_model(str(model_path))
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„

### ä¿®æ­£å‰

```
è©•ä¾¡æ™‚ï¼ˆeval_0-3mï¼‰:
  äºˆæ¸¬ç¢ºç‡: å…¨å“¡ 0.47 ï¼ˆå›ºå®šï¼‰
  Precision: 0.27 (ç¶™ç¶šç‡ã¨åŒã˜)
  Recall: 1.00 (å…¨å“¡ç¶™ç¶šã¨äºˆæ¸¬)
  â†’ ãƒ¢ãƒ‡ãƒ«ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„
```

### ä¿®æ­£å¾Œï¼ˆæœŸå¾…ï¼‰

```
è©•ä¾¡æ™‚ï¼ˆeval_0-3mï¼‰:
  äºˆæ¸¬ç¢ºç‡: 0.0-0.8 ï¼ˆåˆ†æ•£ï¼‰
  Precision: 0.6-0.9
  Recall: 0.5-0.7
  â†’ è¨“ç·´æ™‚ã¨åŒã˜ãƒãƒ©ãƒ³ã‚¹
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1ã¤ã®ãƒ¢ãƒ‡ãƒ«ã§ãƒ†ã‚¹ãƒˆ

```bash
# 1. train_0-3m ã‚’å†è¨“ç·´
rm -rf outputs/sliding_cross_eval_nova/train_0-3m
uv run python scripts/training/irl/train_irl_sliding_window.py \
  --reviews data/review_requests_openstack_multi_5y_detail.csv \
  --train-start 2021-01-01 \
  --train-end 2023-01-01 \
  --eval-start 2023-01-01 \
  --eval-end 2024-01-01 \
  --future-window-start 0 \
  --future-window-end 3 \
  --epochs 20 \
  --min-history-events 1 \
  --project openstack/nova \
  --output outputs/sliding_cross_eval_nova/train_0-3m

# 2. eval_0-3m ã‚’å†è©•ä¾¡
rm -rf outputs/sliding_cross_eval_nova/train_0-3m/eval_0-3m
uv run python scripts/training/irl/train_irl_sliding_window.py \
  --reviews data/review_requests_openstack_multi_5y_detail.csv \
  --train-start 2021-01-01 \
  --train-end 2023-01-01 \
  --eval-start 2023-01-01 \
  --eval-end 2024-01-01 \
  --future-window-start 0 \
  --future-window-end 3 \
  --eval-future-window-start 0 \
  --eval-future-window-end 3 \
  --epochs 0 \
  --min-history-events 1 \
  --project openstack/nova \
  --model outputs/sliding_cross_eval_nova/train_0-3m/irl_model.pt \
  --output outputs/sliding_cross_eval_nova/train_0-3m/eval_0-3m

# 3. çµæœç¢ºèª
python3 << 'PYTHON'
import json
import pandas as pd

# è¨“ç·´æ™‚
train_metrics = json.load(open('outputs/sliding_cross_eval_nova/train_0-3m/metrics.json'))
train_pred = pd.read_csv('outputs/sliding_cross_eval_nova/train_0-3m/predictions.csv')

# è©•ä¾¡æ™‚
eval_metrics = json.load(open('outputs/sliding_cross_eval_nova/train_0-3m/eval_0-3m/metrics.json'))
eval_pred = pd.read_csv('outputs/sliding_cross_eval_nova/train_0-3m/eval_0-3m/predictions.csv')

print("=== è¨“ç·´æ™‚ ===")
print(f"  Precision: {train_metrics['precision']:.3f}")
print(f"  Recall: {train_metrics['recall']:.3f}")
print(f"  äºˆæ¸¬ç¢ºç‡: {train_pred['predicted_prob'].min():.4f} - {train_pred['predicted_prob'].max():.4f}")

print("\n=== è©•ä¾¡æ™‚ ===")
print(f"  Precision: {eval_metrics['precision']:.3f}")
print(f"  Recall: {eval_metrics['recall']:.3f}")
print(f"  äºˆæ¸¬ç¢ºç‡: {eval_pred['predicted_prob'].min():.4f} - {eval_pred['predicted_prob'].max():.4f}")

print("\n=== ä¸€è‡´ãƒã‚§ãƒƒã‚¯ ===")
print(f"  Precisionã®å·®: {abs(train_metrics['precision'] - eval_metrics['precision']):.4f}")
print(f"  Recallã®å·®: {abs(train_metrics['recall'] - eval_metrics['recall']):.4f}")
print(f"  âœ… ä¸€è‡´: {abs(train_metrics['precision'] - eval_metrics['precision']) < 0.01}")
PYTHON
```

### å…¨ãƒ¢ãƒ‡ãƒ«å†å®Ÿè¡Œ

```bash
# ã™ã¹ã¦å‰Šé™¤ã—ã¦å†å®Ÿè¡Œ
rm -rf outputs/sliding_cross_eval_nova
bash scripts/training/irl/run_sliding_cross_evaluation_nova.sh
```

---

## ğŸ“ ã¾ã¨ã‚

### å•é¡Œ
- ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã¦ã„ãªã‹ã£ãŸ
- è©•ä¾¡æ™‚ã®äºˆæ¸¬ãŒãƒ©ãƒ³ãƒ€ãƒ ã«è¿‘ã„çŠ¶æ…‹ã«ãªã£ã¦ã„ãŸ

### ä¿®æ­£
- `load_model` ã®è¿”ã‚Šå€¤ã‚’æ­£ã—ãä½¿ã†ã‚ˆã†ã«ä¿®æ­£
- `save_model` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦configå«ã‚ã¦ä¿å­˜

### å½±éŸ¿
- å…¨ã¦ã®è©•ä¾¡çµæœï¼ˆeval_*ï¼‰ãŒç„¡åŠ¹
- å†å®Ÿè¡ŒãŒå¿…è¦

å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ
