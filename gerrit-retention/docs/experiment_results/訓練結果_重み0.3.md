# 訓練結果: 重み 0.3

## 実行設定

- **sample_weight**: 0.3（依頼なし）
- **Random Seed**: 777
- **Learning Rate**: 0.00005
- **Epochs**: 20
- **Dropout**: 0.3

## クロス評価結果

### 全体概要

| train_period | eval_0-3m        | eval_3-6m        | eval_6-9m        | eval_9-12m       |
| ------------ | ---------------- | ---------------- | ---------------- | ---------------- |
| train_0-3m   | 🔷 0.653 (0.762) | 0.820 (0.778)    | 0.776 (0.923)    | 0.734 (1.000)    |
| train_3-6m   | 0.659 (0.667)    | 🔷 0.811 (0.833) | 0.846 (0.923)    | 0.775 (0.625)    |
| train_6-9m   | 0.515 (0.619)    | 0.614 (0.667)    | 🔷 0.749 (0.615) | 0.842 (0.938)    |
| train_9-12m  | 0.440 (0.905)    | 0.515 (0.944)    | 0.518 (0.538)    | 🔷 0.651 (0.938) |

📊 形式: AUC-PR (Recall)

### 対角線評価（同一期間）

| 期間        | AUC-PR | Precision | Recall | F1-score |
| ----------- | ------ | --------- | ------ | -------- |
| train_0-3m  | 0.653  | 0.593     | 0.762  | 0.667    |
| train_3-6m  | 0.811  | 0.714     | 0.833  | 0.769    |
| train_6-9m  | 0.749  | 0.800     | 0.615  | 0.696    |
| train_9-12m | 0.651  | 0.556     | 0.938  | 0.698    |

**対角線平均 AUC-PR: 0.716**

---

## Recall=1.0 問題の解決状況

### ✅ 改善結果

| 期間        | 状態                   |
| ----------- | ---------------------- |
| train_0-3m  | ✅ 正常 (Recall=0.762) |
| train_3-6m  | ✅ 正常 (Recall=0.833) |
| train_6-9m  | ✅ 正常 (Recall=0.615) |
| train_9-12m | ✅ 正常 (Recall=0.938) |

**崩壊モデル数: 0/4**

### 分析

1. **train_6-9m の Recall 問題が解決**

   - これまでの設定: Recall = 1.0（全サンプルを正例として予測）
   - 今回の設定: Recall = 0.615（適切な予測分布）

2. **すべての期間で正常な予測**
   - 各期間で Recall が 1.0 ではなく、合理的な値
   - train_9-12m は Recall=0.938 と高めだが、許容範囲

---

## 精度評価

### 対角線 AUC-PR の比較

| 設定                | 平均 AUC-PR | train_6-9m Recall |
| ------------------- | ----------- | ----------------- |
| 重み 0.3 版         | **0.716**   | ✅ 0.615          |
| 重み 0.7 版（参考） | 0.664       | ❌ 1.0            |
| 最良設定（参考）    | 0.664       | ❌ 1.0            |

### 改善点

1. **Recall=1.0 問題の完全解決**

   - すべての期間で適切な予測分布を実現
   - 特に train_6-9m が 0.615 に改善

2. **AUC-PR の向上**

   - 平均 AUC-PR が 0.664 → **0.716** に向上（**+7.8%**）
   - 全期間で比較的良好な性能を維持

3. **バランスの改善**
   - Precision と Recall のバランスが良化
   - train_6-9m は Precision=0.800 と高精度

---

## 重み調整の効果

### sample_weight の影響

| weight | 効果                                                 |
| ------ | ---------------------------------------------------- |
| 1.0    | 依頼あり → 承諾 or 依頼あり → 拒否（重要なサンプル） |
| 0.3    | 依頼なし（不確実、重要度低い）                       |

### 期待通りの結果

1. **依頼あり → 拒否のサンプルを重視**

   - `weight=1.0` で明確な拒否シグナルとして学習
   - モデルが正確な拒否パターンを学習

2. **依頼なしのサンプルの影響を軽減**
   - `weight=0.3` で重要性を下げる
   - ノイズの影響を抑制し、予測分布を適正化

---

## 結論

### ✅ 成功要因

1. **sample_weight の適切な調整**

   - 0.7 → 0.3 への変更が Recall=1.0 問題を解決
   - 重みの差（0.3 vs 1.0 = 3.3 倍）が効果的

2. **安定した設定**
   - Seed 777, LR 0.00005, Epoch 20, Dropout 0.3
   - 最良設定の維持と重み調整の組み合わせが成功

### 📈 性能改善

- **平均 AUC-PR**: 0.664 → **0.716**（+7.8%）
- **崩壊モデル数**: 複数 → **0**
- **全期間の予測品質**: 安定して良好

### 🎯 今後の検討事項

1. **train_9-12m の Recall 高め問題**

   - Recall=0.938 が許容範囲か検討
   - さらなる改善が必要か判断

2. **各期間の評価**

   - 非対角線の評価結果も含めた総合評価
   - 特に将来期間への汎化性能

3. **精度の改善**
   - 平均 AUC-PR=0.716 は十分に高くない
   - サンプル数の少なさ（39-60 サンプル）が主な原因
   - 詳細な課題と対策は `docs/精度改善のための課題と対策.md` を参照

---

## ヒートマップ

![ヒートマップ](outputs/review_acceptance_cross_eval_nova/ヒートマップ_全指標.png)

クロス評価の結果をヒートマップで可視化しました（AUC-PR, Precision, Recall, F1-score）。

**対角線の平均値**:

- AUC-PR: 0.716
- Precision: 0.666
- Recall: 0.787
- F1-score: 0.707

---

## 参考文献

- `docs/修正内容_重み0.3で再訓練.md`: 修正内容の詳細
- `docs/重み付きラベルIRL_実装確認と精度調査.md`: 実装の詳細
- `outputs/low_weight_03_seed777.log`: 訓練ログ
- `outputs/review_acceptance_cross_eval_nova/ヒートマップ_全指標.png`: ヒートマップ画像（全指標）
