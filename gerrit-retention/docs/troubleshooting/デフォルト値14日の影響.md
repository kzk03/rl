# デフォルト値14日の影響

## 📊 概要

レスポンス時間のデフォルト値を **3日（平均）から14日（最大/未応答）** に変更した結果をまとめます。

## 🎯 主な変更点

### デフォルト値の変更
- **変更前**: `response_time` が欠損の場合 → 3.0日（平均レスポンス時間）
- **変更後**: `response_time` が欠損の場合 → 14.0日（最大レスポンス時間/未応答）

### 実装の修正
- `timestamp`フィールドを常に`date_col`（`request_time`）にするように修正
- `response_time`フィールドを`first_response_time`から取得するように修正
- `RetentionIRLSystem`の`_calculate_response_time`メソッドを`timestamp` → `response_time`フィールドを見るように修正

## 📈 訓練結果

### 対角線評価（同一期間）の比較

| 期間   | デフォルト3日 | デフォルト14日 | 差分     |
|--------|-------------|--------------|---------|
| 0-3m   | 0.611       | 0.610        | -0.002  |
| 3-6m   | 0.816       | 0.771        | -0.045  |
| 6-9m   | 0.788       | 0.608        | -0.181  |
| 9-12m  | 0.658       | 0.752        | +0.094  |

**平均 AUC-PR**:
- デフォルト3日: **0.718**
- デフォルト14日: **0.685**
- **差分: -0.033**（低下）

## 🔍 考察

### デフォルト値の影響は小さかったが有意

**結論**: デフォルト値を3日から14日に変更すると、予測性能が **0.033低下**しました。

### 理由の推測

1. **response_speedの計算**:
   - `response_speed = 1.0 / (1.0 + response_time / 3.0)`
   - デフォルト3日 → speed = 0.5
   - デフォルト14日 → speed = 0.18
   - 0.32の差がある

2. **データの分布**:
   - 欠損値が全体の約91.5%を占める
   - デフォルト値の差が全体の91.5%のデータに影響
   - しかし、モデルの学習済みパターンがある程度補正している可能性

3. **期間ごとの差**:
   - `train_6-9m`で最大の低下（-0.181）
   - `train_9-12m`で改善（+0.094）
   - 期間による影響のばらつきが大きい

### 応答速度の負の重要性について

先の分析で、`response_speed`の重要度が**負**（-0.0061）であることを確認しています。

これは以下の意味があります：
- **速い応答 = 継続傾向が低い**
- **遅い応答 = 継続傾向が高い**

デフォルト値を14日に変更すると、欠損データが「遅い応答」として扱われるようになり、**継続傾向が少し上がる**と考えられます。

しかし、実際の結果は**性能が低下**しています。これは以下の理由が考えられます：

1. **デフォルト値は「未応答」を示すべき**
   - 平均値（3日）よりも最大値（14日）の方が「未応答/非アクティブ」を示す
   - しかし、実際の「応答している」レビュアーとの区別がつかなくなる

2. **欠損値の意味**
   - 欠損値は「まだ応答していない」ケースが多い
   - これらを「最大レスポンス時間」として扱うと、実際の応答パターンを混乱させる

## 💡 まとめ

### デフォルト値14日の影響

**結論**:
- デフォルト値を3日→14日に変更すると、予測性能が**0.033低下**した
- 影響は小さいが、**有意**である
- 期間によるばらつきが大きい（-0.181 ～ +0.094）

### 応答速度の負の重要性は維持

**重要な発見**:
- デフォルト値を変更しても、応答速度の負の重要性は維持される可能性が高い
- 「軽いコミットメント vs 深いコミットメント」の実際のパターンを示している

### 今後の改善案

1. **デフォルト値の検討**:
   - 3日（平均）vs 14日（最大）のどちらが適切か、さらなる検証が必要
   - または、欠損値を別の特徴量として扱う方法を検討

2. **欠損値の扱い**:
   - 「レスポンスなし」を別のフラグとして追加
   - デフォルト値に依存しない設計を検討

3. **期間ごとの差**:
   - なぜ`train_6-9m`で最大の低下が起きたのか調査
   - この期間のデータ特性を分析

## 📂 出力ファイル

```
outputs/review_acceptance_cross_eval_nova_default14/
├── heatmap_combined.png                          # 統合ヒートマップ
├── matrix_AUC_PR.csv                            # AUC-PRマトリクス
├── matrix_PRECISION.csv                         # Precisionマトリクス
├── matrix_RECALL.csv                            # Recallマトリクス
├── matrix_F1.csv                                # F1-scoreマトリクス
├── average_feature_importance/
│   ├── gradient_importance.png                  # 特徴量重要度グラフ
│   ├── gradient_importance_combined.png         # 統合特徴量重要度グラフ
│   └── gradient_importance_average.json         # 平均重要度JSON
└── train_*/feature_importance/
    ├── gradient_importance.png
    └── gradient_importance_combined.png
```

## 📅 実施日

2024年10月30日

## 🔗 関連ドキュメント

- [再訓練結果_デフォルト値3日.md](再訓練結果_デフォルト値3日.md)
- [再訓練結果_デフォルト値14日.md](再訓練結果_デフォルト値14日.md)
- [応答速度の負の影響_考察.md](応答速度の負の影響_考察.md)

