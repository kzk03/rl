# 除外理由: 実質離脱者の扱い

## 📅 作成日
2025-10-30

## 🤔 ユーザーの質問

> 評価期間で除外する理由は？？予測の母集団に入れないため？？

## ✅ 回答

**はい、その通りです！予測の母集団に入れないためです。**

---

## 📊 除外の理由

### 1. 実質離脱者の定義

```
評価期間（例: 3-6ヶ月）に依頼なし
↓
拡張期間（例: 3-12ヶ月）にも依頼なし
↓
結論: 実質的に離脱したレビュアー
```

### 2. なぜ除外するのか？

#### ❌ 除外しない場合の問題

1. **予測不可能な対象**
   - 完全に離脱したレビュアーは予測しようがない
   - モデルに学習させても意味がない

2. **ノイズの増加**
   - 予測可能性のあるサンプルと混在する
   - モデルの性能が低下

3. **タスクの定義が不明確に**
   - 「継続予測」なのか「離脱予測」なのか曖昧に

#### ✅ 除外する場合の利点

1. **予測の母集団を明確に**
   - 予測可能性のあるレビュアーのみ
   - タスクが明確に

2. **データ品質の向上**
   - より信頼性の高いサンプルのみ
   - モデルの性能向上に寄与

3. **実用性の向上**
   - 「離脱した人」ではなく「将来どうなるか予測可能な人」にフォーカス

---

## 🔍 具体例

### シナリオ

```
訓練期間: 2021-01-01 ～ 2023-01-01
評価期間: 3-6ヶ月 (2023-04-01 ～ 2023-07-01)
拡張期間: 3-12ヶ月 (2023-04-01 ～ 2024-01-01)

レビュアーA:
- 訓練期間中: 活動あり
- 評価期間（3-6m）: 依頼なし
- 拡張期間（6-12m）: 依頼あり ← 再帰の可能性
→ 重み付き負例（sample_weight=0.1）

レビュアーB:
- 訓練期間中: 活動あり
- 評価期間（3-6m）: 依頼なし
- 拡張期間（6-12m）: 依頼なし ← 実質離脱
→ 除外
```

### 判断理由

| レビュアー | 判断 | 理由 |
|------------|------|------|
| **レビュアーA** | 重み付き負例 | 3-6mは依頼なしだが、6-12mで再帰する可能性がある |
| **レビュアーB** | 除外 | 評価期間+拡張期間で完全に依頼なし → 実質離脱 |

---

## 📋 除外の条件

### 除外されるサンプル

```
1. 訓練期間中に活動があったレビュアー
   AND
2. 評価期間（future_window）に依頼がない
   AND
3. 拡張期間（最大12ヶ月）にも依頼がない
```

→ **実質的に離脱したレビュアー**

### 重み付きで残るサンプル

```
1. 訓練期間中に活動があったレビュアー
   AND
2. 評価期間（future_window）に依頼がない
   AND
3. 拡張期間（最大12ヶ月）に依頼がある
```

→ **一時的な依頼減少（再帰の可能性がある）**

---

## 🎯 まとめ

### 除外の目的

1. **予測の母集団を明確にする**
   - 予測可能性のあるレビュアーのみを対象
   - 実質離脱者は対象外

2. **データ品質の向上**
   - ノイズとなる予測不可能なサンプルを除外
   - より信頼性の高いサンプルのみに集中

3. **タスクの定義を明確にする**
   - 「継続予測」にフォーカス
   - 「離脱予測」とは区別

### 実装上の判断

```
if 評価期間に依頼なし:
    if 拡張期間にも依頼なし:
        continue  # 除外（実質離脱者）
    else:
        sample_weight = 0.1  # 重み付き負例（再帰の可能性）
```

---

## 📚 参考

- [改善実装_拡張期間考慮の除外](改善実装_拡張期間考慮の除外.md)
- [予測性能向上案_ラベリング改善](予測性能向上案_ラベリング改善.md)

---

作成日: 2025-10-30

