# 修正内容: 重み 0.3 で再訓練

## 修正内容

### 1. sample_weight の調整

**変更前**: `sample_weight = 0.7` (依頼なし)  
**変更後**: `sample_weight = 0.3` (依頼なし)

**修正箇所**: `scripts/training/irl/train_irl_review_acceptance.py`

- 行 224, 498: `sample_weight = 0.7` → `sample_weight = 0.3`
- 行 345, 566: コメント更新

### 2. 最良設定に戻す

**Seed**: 888 → **777**  
**Learning Rate**: 0.000075 → **0.00005**  
**Epoch**: 25 → **20**  
**Dropout**: 0.3 (変更なし)

### 3. 重みの役割（修正後）

| 状況            | sample_weight | 理由                                                 |
| --------------- | ------------- | ---------------------------------------------------- |
| 依頼あり → 承諾 | 1.0           | 正例、最も重要                                       |
| 依頼あり → 拒否 | 1.0           | 負例、重要（明確な拒否シグナル）                     |
| 依頼なし        | 0.3           | 負例、重要度低い（不確実：アサインされなかっただけ） |

---

## 期待される効果

### 理論的な改善

1. **依頼あり → 拒否のサンプルを重視**

   - `weight=1.0` で明確な拒否シグナルとして学習
   - モデルが拒否パターンを正確に学習

2. **依頼なしのサンプルの影響を軽減**

   - `weight=0.3` で重要性を下げる
   - ノイズの影響を抑制

3. **バランスの改善**
   - 訓練サンプル数の増加（依頼なし追加）による正例率の低下を緩和
   - より意味のあるサンプルを重視

### 期待される性能

**目標**: 最良設定（AUC-PR 0.664）を超える  
または同等の性能を維持しつつ、train_6-9m の Recall=1.0 問題を解決

---

## 実行手順

```bash
cd /Users/kazuki-h/rl/gerrit-retention

# 既存の結果を削除
rm -rf outputs/review_acceptance_cross_eval_nova

# 再訓練を実行
caffeinate -s -i -w $$ uv run python scripts/analysis/run_review_acceptance_cross_eval.py \
    2>&1 | tee outputs/low_weight_03_seed777.log &
```

---

## 結果確認

実行完了後、以下を確認：

1. **訓練サンプル数**:

   ```python
   # 各訓練期間で
   - 総サンプル数
   - weight=0.3のサンプル数
   - weight=1.0のサンプル数
   - rescued_by_extended 数
   ```

2. **精度メトリクス**:

   - AUC-PR（対角線）
   - Recall（Recall=1.0 問題の解決状況）
   - Precision

3. **比較**:
   - 最良設定（0.664）と比較
   - train_6-9m の Recall=1.0 問題の改善状況

---

## 備考

- 本修正により、重みの差が大きくなり（0.3 vs 1.0 = 3.3 倍）、サンプルの重要性の区別が明確になる
- 最良設定（Seed 777）に戻すことで、実装前の性能をベースラインとして比較可能
