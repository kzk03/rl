# æ‹¡å¼µ IRL å®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

æ‹¡å¼µ IRLï¼ˆEnhancedRetentionIRLSystemï¼‰ã¯ã€é€šå¸¸ IRL ã® 10 æ¬¡å…ƒã®çŠ¶æ…‹ç‰¹å¾´é‡ã‚’ 32 æ¬¡å…ƒã«æ‹¡å¼µã—ã€ã‚ˆã‚Šè±Šå¯Œãªç‰¹å¾´é‡ã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºè€…ã®ç¶™ç¶šäºˆæ¸¬ã‚’è¡Œã„ã¾ã™ã€‚

## ğŸ†š é€šå¸¸ IRL vs æ‹¡å¼µ IRL ã®æ¯”è¼ƒ

| é …ç›®             | **é€šå¸¸ IRL**       | **æ‹¡å¼µ IRL**             |
| ---------------- | ------------------ | ------------------------ |
| **çŠ¶æ…‹ç‰¹å¾´é‡**   | 10 æ¬¡å…ƒ            | **32 æ¬¡å…ƒ** â­           |
| **è¡Œå‹•ç‰¹å¾´é‡**   | 5 æ¬¡å…ƒ             | **9 æ¬¡å…ƒ** â­            |
| **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯** | hidden_dim=128     | **hidden_dim=256**       |
| **ç‰¹å¾´é‡**       | åŸºæœ¬çš„ãªç‰¹å¾´é‡ã®ã¿ | **é«˜å„ªå…ˆåº¦ç‰¹å¾´é‡ã‚’çµ±åˆ** |
| **å®Ÿè¡Œé€Ÿåº¦**     | é€Ÿã„               | ã‚„ã‚„é…ã„                 |
| **ãƒ¡ãƒ¢ãƒª**       | å°‘ãªã„             | ã‚„ã‚„å¤šã„                 |

## ğŸ“Š æ‹¡å¼µç‰¹å¾´é‡ã®è©³ç´°

### çŠ¶æ…‹ç‰¹å¾´é‡ï¼ˆ32 æ¬¡å…ƒï¼‰

#### **åŸºæœ¬ç‰¹å¾´é‡**ï¼ˆ10 æ¬¡å…ƒï¼‰

é€šå¸¸ IRL ã¨åŒã˜ï¼š

1. çµŒé¨“æ—¥æ•°ï¼ˆå¹´å˜ä½ï¼‰
2. ç·å¤‰æ›´æ•°ï¼ˆ/100ï¼‰
3. ç·ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ï¼ˆ/100ï¼‰
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°ï¼ˆ/10ï¼‰
5. æœ€è¿‘ã®æ´»å‹•é »åº¦
6. å¹³å‡æ´»å‹•é–“éš”ï¼ˆæœˆå˜ä½ï¼‰
7. æ´»å‹•ãƒˆãƒ¬ãƒ³ãƒ‰
8. å”åŠ›ã‚¹ã‚³ã‚¢
9. ã‚³ãƒ¼ãƒ‰å“è³ªã‚¹ã‚³ã‚¢
10. æ™‚é–“çµŒéï¼ˆå¹´å˜ä½ï¼‰

#### **A1: æ´»å‹•é »åº¦ã®å¤šæœŸé–“æ¯”è¼ƒ**ï¼ˆ5 æ¬¡å…ƒï¼‰

11. 7 æ—¥é–“ã®æ´»å‹•é »åº¦
12. 30 æ—¥é–“ã®æ´»å‹•é »åº¦
13. 90 æ—¥é–“ã®æ´»å‹•é »åº¦
14. æ´»å‹•åŠ é€Ÿåº¦ï¼ˆçŸ­æœŸ vs ä¸­æœŸï¼‰
15. ä¸€è²«æ€§ã‚¹ã‚³ã‚¢ï¼ˆæ¨™æº–åå·®ãƒ™ãƒ¼ã‚¹ï¼‰

#### **B1: ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·æŒ‡æ¨™**ï¼ˆ6 æ¬¡å…ƒï¼‰

16. 7 æ—¥é–“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ï¼ˆä»¶/æ—¥ï¼‰
17. 30 æ—¥é–“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·
18. 180 æ—¥é–“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·
19. ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ãƒˆãƒ¬ãƒ³ãƒ‰
20. éè² è·ãƒ•ãƒ©ã‚°ï¼ˆ5 ä»¶/æ—¥ä»¥ä¸Šï¼‰
21. é«˜è² è·ãƒ•ãƒ©ã‚°ï¼ˆ2 ä»¶/æ—¥ä»¥ä¸Šï¼‰

#### **C1: ç›¸äº’ä½œç”¨ã®æ·±ã•**ï¼ˆ4 æ¬¡å…ƒï¼‰

22. 180 æ—¥é–“ã®ç›¸äº’ä½œç”¨æ•°
23. ç›¸äº’ä½œç”¨å¼·åº¦ï¼ˆinteractions/months_activeï¼‰
24. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ç›¸äº’ä½œç”¨
25. å‰²ã‚Šå½“ã¦å±¥æ­´ï¼ˆ180 æ—¥ï¼‰

#### **D1: å°‚é–€æ€§ã®ä¸€è‡´åº¦**ï¼ˆ2 æ¬¡å…ƒï¼‰

26. ãƒ‘ã‚¹é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ï¼ˆJaccard å¹³å‡ï¼‰
27. ãƒ‘ã‚¹ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¹ã‚³ã‚¢

#### **ãã®ä»–**ï¼ˆ5 æ¬¡å…ƒï¼‰

28. å¹³å‡å¿œç­”æ™‚é–“ï¼ˆæ—¥ï¼‰
29. å¿œç­”ç‡ï¼ˆ180 æ—¥ï¼‰
30. åœ¨ç±æ—¥æ•°
31. å¹³å‡å¤‰æ›´ã‚µã‚¤ã‚º
32. å¹³å‡å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°

### è¡Œå‹•ç‰¹å¾´é‡ï¼ˆ9 æ¬¡å…ƒï¼‰

#### **åŸºæœ¬ç‰¹å¾´é‡**ï¼ˆ5 æ¬¡å…ƒï¼‰

é€šå¸¸ IRL ã¨åŒã˜ï¼š

1. è¡Œå‹•ã‚¿ã‚¤ãƒ—
2. å¼·åº¦
3. å“è³ª
4. å”åŠ›åº¦
5. æ™‚é–“çµŒé

#### **æ‹¡å¼µç‰¹å¾´é‡**ï¼ˆ4 æ¬¡å…ƒï¼‰

6. å¤‰æ›´æŒ¿å…¥è¡Œæ•°
7. å¤‰æ›´å‰Šé™¤è¡Œæ•°
8. å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°
9. å¿œç­”é…å»¶æ™‚é–“ï¼ˆæ—¥ï¼‰

## ğŸš€ å®Ÿè¡Œæ–¹æ³•

### ã‚µãƒ¼ãƒã§ã®å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰

```bash
# æ‹¡å¼µIRLå®Œå…¨ã‚¯ãƒ­ã‚¹è©•ä¾¡ã‚’å®Ÿè¡Œ
cd /path/to/gerrit-retention
bash scripts/training/irl/run_enhanced_cross_evaluation.sh
```

### å®Ÿè¡Œã•ã‚Œã‚‹å†…å®¹

**5 ã¤ã®è¨“ç·´ãƒ©ãƒ™ãƒ« Ã— 4 ã¤ã®è©•ä¾¡æœŸé–“ = 20 è©•ä¾¡**

#### è¨“ç·´ãƒ©ãƒ™ãƒ«

- 0-1m
- 0-3m
- 0-6m
- 0-9m
- 0-12m

#### è©•ä¾¡æœŸé–“

- 0-3m
- 3-6m
- 6-9m
- 9-12m

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼ˆscripts/training/irl/run_enhanced_cross_evaluation.shï¼‰
REVIEWS_FILE="data/review_requests_openstack_multi_5y_detail.csv"
TRAIN_START="2021-01-01"
TRAIN_END="2023-01-01"
EVAL_START="2023-01-01"
EVAL_END="2024-01-01"
HISTORY_WINDOW=12  # ãƒ¶æœˆ
EPOCHS=20
```

## â±ï¸ äºˆæƒ³å®Ÿè¡Œæ™‚é–“

### ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆMacbookï¼‰

- 1 ãƒ¢ãƒ‡ãƒ«è¨“ç·´: ç´„ 1-1.5 æ™‚é–“
- å®Œå…¨ã‚¯ãƒ­ã‚¹è©•ä¾¡ï¼ˆ5 ãƒ¢ãƒ‡ãƒ«ï¼‰: **ç´„ 5-7 æ™‚é–“**

### ã‚µãƒ¼ãƒï¼ˆå¼·åŠ›ãª GPUï¼‰

- 1 ãƒ¢ãƒ‡ãƒ«è¨“ç·´: ç´„ 30-40 åˆ†
- å®Œå…¨ã‚¯ãƒ­ã‚¹è©•ä¾¡ï¼ˆ5 ãƒ¢ãƒ‡ãƒ«ï¼‰: **ç´„ 2.5-3.5 æ™‚é–“**

âš ï¸ **æ³¨æ„**: æ‹¡å¼µ IRL ã¯é€šå¸¸ IRL ã‚ˆã‚Šç´„ 1.2-1.5 å€æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™

## ğŸ“Š å‡ºåŠ›çµæœ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
outputs/enhanced_cross_eval/
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ main.log
â”‚   â”œâ”€â”€ train_0-1m.log
â”‚   â”œâ”€â”€ train_0-3m.log
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ train_0-12m_eval_9-12m.log
â”œâ”€â”€ train_0-1m/
â”‚   â”œâ”€â”€ enhanced_irl_model.pt  â† æ‹¡å¼µIRLãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ metrics.json
â”‚   â”œâ”€â”€ predictions.csv
â”‚   â”œâ”€â”€ train_trajectories.pkl
â”‚   â””â”€â”€ eval_trajectories.pkl
â”œâ”€â”€ train_0-3m/
â”‚   â””â”€â”€ ...
â””â”€â”€ train_0-12m/
    â””â”€â”€ ...
```

### çµæœã®ç¢ºèª

```bash
# ãƒ¡ã‚¤ãƒ³ãƒ­ã‚°ã‚’ç¢ºèª
tail -f outputs/enhanced_cross_eval/logs/main.log

# è¨“ç·´ãƒ­ã‚°ã‚’ç¢ºèª
tail -f outputs/enhanced_cross_eval/logs/train_0-3m.log

# çµæœã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆ
uv run python scripts/training/irl/summarize_full_cross_evaluation.py \
  --input outputs/enhanced_cross_eval \
  --output outputs/enhanced_cross_eval/summary.md
```

## ğŸ”„ é€šå¸¸ IRL ã¨ã®æ¯”è¼ƒ

### æ¯”è¼ƒå®Ÿè¡Œ

é€šå¸¸ IRL ã¨ã® AUC-ROC æ¯”è¼ƒï¼š

```bash
# é€šå¸¸IRLï¼ˆå®Ÿè¡Œæ¸ˆã¿ï¼‰
ls outputs/full_cross_eval/train_*/metrics.json

# æ‹¡å¼µIRLï¼ˆå®Ÿè¡Œå¾Œï¼‰
ls outputs/enhanced_cross_eval/train_*/metrics.json

# æ¯”è¼ƒã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆä½œæˆäºˆå®šï¼‰
python scripts/analysis/compare_irl_versions.py \
  --baseline outputs/full_cross_eval \
  --enhanced outputs/enhanced_cross_eval \
  --output outputs/irl_comparison.md
```

### æœŸå¾…ã•ã‚Œã‚‹æ”¹å–„

æ‹¡å¼µç‰¹å¾´é‡ã«ã‚ˆã‚Šä»¥ä¸‹ã®æ”¹å–„ãŒæœŸå¾…ã•ã‚Œã¾ã™ï¼š

- **AUC-ROC**: +0.02-0.05 ç¨‹åº¦ã®æ”¹å–„
- **AUC-PR**: +0.03-0.07 ç¨‹åº¦ã®æ”¹å–„
- **F1 ã‚¹ã‚³ã‚¢**: +0.01-0.03 ç¨‹åº¦ã®æ”¹å–„

ç‰¹ã«ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§æ”¹å–„ãŒå¤§ãã„ã¨äºˆæƒ³ï¼š

- ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ãŒé«˜ã„é–‹ç™ºè€…
- å°‚é–€æ€§ã®ä¸€è‡´åº¦ãŒé‡è¦ãªå ´åˆ
- æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å¤‰åŒ–ãŒæ¿€ã—ã„é–‹ç™ºè€…

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

```bash
# ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™ï¼ˆæœªå®Ÿè£…ã®å ´åˆã¯å®Ÿè£…ãŒå¿…è¦ï¼‰
# ã¾ãŸã¯ã€ã‚ˆã‚Šå°ã•ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§è©¦ã™
```

### å®Ÿè¡ŒãŒé…ã„

```bash
# EPOCHSã‚’æ¸›ã‚‰ã—ã¦è©¦ã™
# ä¾‹: EPOCHS=10
sed -i '' 's/EPOCHS=20/EPOCHS=10/' scripts/training/irl/run_enhanced_cross_evaluation.sh
```

### ScalerFitting ã‚¨ãƒ©ãƒ¼

æ‹¡å¼µ IRL ã¯åˆå›å®Ÿè¡Œæ™‚ã«ç‰¹å¾´é‡ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã„ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆï¼š

```bash
# ãƒ‡ãƒ¼ã‚¿ãŒååˆ†ã«ã‚ã‚‹ã‹ç¢ºèª
# æœ€ä½100ã‚µãƒ³ãƒ—ãƒ«ç¨‹åº¦å¿…è¦
```

## ğŸ“ ã‚µãƒ¼ãƒå®Ÿè¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å®Ÿè¡Œå‰

- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ï¼ˆ`data/review_requests_openstack_multi_5y_detail.csv`ï¼‰
- [ ] `uv`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] ååˆ†ãªãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãŒã‚ã‚‹ï¼ˆç´„ 5GB ä»¥ä¸Šï¼‰
- [ ] ä»–ã®å®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹ã¨ç«¶åˆã—ãªã„ã‹ç¢ºèª

### å®Ÿè¡Œä¸­

- [ ] `caffeinate`ã§ã‚¹ãƒªãƒ¼ãƒ—é˜²æ­¢ï¼ˆmacOSï¼‰
- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§é€²æ—ç¢ºèª
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### å®Ÿè¡Œå¾Œ

- [ ] å…¨ 5 ãƒ¢ãƒ‡ãƒ«ãŒå®Œæˆã—ãŸã‹ç¢ºèªï¼ˆ`ls outputs/enhanced_cross_eval/train_*/enhanced_irl_model.pt`ï¼‰
- [ ] ã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- [ ] é€šå¸¸ IRL ã¨ã®æ¯”è¼ƒ

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### æ€§èƒ½æ¯”è¼ƒ

```bash
# 1. ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
python scripts/training/irl/summarize_full_cross_evaluation.py \
  --input outputs/enhanced_cross_eval \
  --output outputs/enhanced_cross_eval/summary.md

# 2. æ¯”è¼ƒåˆ†æ
python scripts/analysis/compare_irl_versions.py \
  --baseline outputs/full_cross_eval \
  --enhanced outputs/enhanced_cross_eval

# 3. ç‰¹å¾´é‡é‡è¦åº¦åˆ†æ
bash scripts/analysis/run_feature_importance_all_models.sh
```

### è«–æ–‡ãƒ»ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ

æ‹¡å¼µç‰¹å¾´é‡ã®åŠ¹æœã‚’æ¤œè¨¼ã—ãŸçµæœã‚’è«–æ–‡ã‚„ãƒ¬ãƒãƒ¼ãƒˆã«ã¾ã¨ã‚ã‚‹éš›ã®ãƒã‚¤ãƒ³ãƒˆï¼š

1. **ç‰¹å¾´é‡ã®è¨­è¨ˆæ ¹æ‹ **

   - ãªãœã“ã‚Œã‚‰ã®ç‰¹å¾´é‡ã‚’é¸ã‚“ã ã‹
   - å…ˆè¡Œç ”ç©¶ã¨ã®é–¢é€£

2. **æ€§èƒ½æ”¹å–„ã®åˆ†æ**

   - ã©ã®ç‰¹å¾´é‡ãŒæœ€ã‚‚åŠ¹æœçš„ã‹
   - ã©ã®ã‚ˆã†ãªçŠ¶æ³ã§æ”¹å–„ãŒå¤§ãã„ã‹

3. **è¨ˆç®—ã‚³ã‚¹ãƒˆã¨ã® ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•**
   - å®Ÿè¡Œæ™‚é–“ã®å¢—åŠ 
   - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å¢—åŠ 
   - æ€§èƒ½æ”¹å–„ãŒå¦¥å½“ã‹

## ğŸ¤ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/ç‰¹å¾´é‡ã®é‡è¦åº¦åˆ†æ.md` - ç‰¹å¾´é‡é‡è¦åº¦ã®æ¸¬å®šæ–¹æ³•
- `docs/å®Œå…¨ã‚¯ãƒ­ã‚¹è©•ä¾¡ã‚¬ã‚¤ãƒ‰.md` - ã‚¯ãƒ­ã‚¹è©•ä¾¡ã®è©³ç´°
- `SERVER_EXECUTION_GUIDE.md` - ã‚µãƒ¼ãƒå®Ÿè¡Œã®è©³ç´°ã‚¬ã‚¤ãƒ‰
- `src/gerrit_retention/rl_prediction/enhanced_feature_extractor.py` - ç‰¹å¾´é‡æŠ½å‡ºã®å®Ÿè£…

## âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

```bash
# ã‚µãƒ¼ãƒã§æ‹¡å¼µIRLã‚’å®Ÿè¡Œï¼ˆæœ€çŸ­æ‰‹é †ï¼‰
cd /path/to/gerrit-retention

# å®Ÿè¡Œï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
nohup bash scripts/training/irl/run_enhanced_cross_evaluation.sh \
  > /tmp/enhanced_cross_eval.log 2>&1 &

# PIDã‚’ä¿å­˜
echo $! > /tmp/enhanced_cross_eval.pid

# ã‚¹ãƒªãƒ¼ãƒ—é˜²æ­¢ï¼ˆmacOSï¼‰
caffeinate -i -s -w $(cat /tmp/enhanced_cross_eval.pid)

# é€²æ—ç¢ºèª
tail -f outputs/enhanced_cross_eval/logs/main.log
```

## ğŸ“§ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’å«ã‚ã¦å ±å‘Šã—ã¦ãã ã•ã„ï¼š

- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- å®Ÿè¡Œç’°å¢ƒï¼ˆOSã€ãƒ¡ãƒ¢ãƒªã€GPU ç­‰ï¼‰
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`outputs/enhanced_cross_eval/logs/*.log`ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°ã€ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼æ•°ï¼‰
