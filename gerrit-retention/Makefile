.PHONY: setup build up down restart clean

# ç’°å¢ƒå¤‰æ•°ã®å–å¾—
export HOST_UID := $(shell id -u)
export HOST_GID := $(shell id -g)
export USERNAME := $(shell whoami)

setup:
	@echo "ğŸš€ ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™..."
	@echo "HOST_UID=$(HOST_UID)" > .env
	@echo "HOST_GID=$(HOST_GID)" >> .env
	@echo "USERNAME=$(USERNAME)" >> .env
	@echo "âœ… .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸ"
	@cat .env

build: setup
	@echo "ğŸ”¨ Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¾ã™..."
	docker compose build

up: build
	@echo "ğŸš€ ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™..."
	docker compose up -d

down:
	@echo "ğŸ›‘ ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã—ã¾ã™..."
	docker compose down

restart: down up

clean: down
	@echo "ğŸ§¹ ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¾ã™..."
	docker compose down -v --rmi all

shell:
	@echo "ğŸ’» ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚Šã¾ã™..."
	docker compose exec app bash

logs:
	docker compose logs -f

.DEFAULT_GOAL := up
