# è¨“ç·´/è©•ä¾¡ãƒ‡ãƒ¼ã‚¿åˆ†å‰²ã®è©³ç´°èª¬æ˜

**ä½œæˆæ—¥**: 2025-11-17
**é‡è¦åº¦**: â­â­â­â­â­ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢ã®æ ¸å¿ƒï¼‰

---

## â“ ã‚ãªãŸã®è³ªå•

> è¨“ç·´æœŸé–“å†…ã§AUC-ROCã‚’æ¸¬ã£ã¦ã„ã‚‹ã®ã¯å…¨ãƒ©ãƒ™ãƒ«ä»˜ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã§è¡Œã£ã¦ã„ã‚‹ï¼Ÿï¼Ÿ

**å›ç­”**: **ã„ã„ãˆã€è¨“ç·´æ™‚ã¨è©•ä¾¡æ™‚ã§ç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã£ã¦ã„ã¾ã™ã€‚**

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿åˆ†å‰²ã®å…¨ä½“åƒ

æœ¬ç ”ç©¶ã§ã¯ã€**2æ®µéšã®è©•ä¾¡**ã‚’è¡Œã£ã¦ã„ã¾ã™ï¼š

### 1. è¨“ç·´æ™‚ã®å†…éƒ¨è©•ä¾¡ï¼ˆè¨“ç·´æœŸé–“å†…ï¼‰
```
ç›®çš„: ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’
ãƒ‡ãƒ¼ã‚¿: è¨“ç·´æœŸé–“å†…ã§å®Œçµ
ãƒªãƒ¼ã‚¯: ãªã—ï¼ˆè¨“ç·´æœŸé–“ã‚’è¶…ãˆãªã„ã‚ˆã†è¨­è¨ˆï¼‰
```

### 2. æœ€çµ‚è©•ä¾¡ï¼ˆè©•ä¾¡æœŸé–“ï¼‰
```
ç›®çš„: çœŸã®æ±åŒ–æ€§èƒ½æ¸¬å®š
ãƒ‡ãƒ¼ã‚¿: cutoffæ—¥ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿
ãƒªãƒ¼ã‚¯: ãªã—ï¼ˆæ™‚ç³»åˆ—çš„ã«å®Œå…¨åˆ†é›¢ï¼‰
```

---

## ğŸ” è©³ç´°è§£èª¬

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: è¨“ç·´æ™‚ã®å†…éƒ¨è©•ä¾¡

**ã‚³ãƒ¼ãƒ‰**: `train_irl_review_acceptance.py:84-228`

```python
def extract_review_acceptance_trajectories(
    df: pd.DataFrame,
    train_start: pd.Timestamp,
    train_end: pd.Timestamp,
    future_window_start_months: int = 0,
    future_window_end_months: int = 3,
    ...
):
    """
    é‡è¦ï¼šè¨“ç·´æœŸé–“å†…ã§å®Œçµã•ã›ã‚‹ãŸã‚ã€è¨“ç·´æœŸé–“ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†å‰²ï¼š
    - **ç‰¹å¾´é‡è¨ˆç®—æœŸé–“**: train_start ï½ (train_end - future_window_end_months)
    - **ãƒ©ãƒ™ãƒ«è¨ˆç®—æœŸé–“**: ç‰¹å¾´é‡è¨ˆç®—æœŸé–“çµ‚äº†å¾Œ ï½ train_end

    ã“ã‚Œã«ã‚ˆã‚Šã€è¨“ç·´æœŸé–“ï¼ˆtrain_endï¼‰ã‚’è¶…ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã›ãšã«ãƒ©ãƒ™ãƒ«ä»˜ã‘ãŒå¯èƒ½ã€‚
    """
```

#### è¨“ç·´æœŸé–“ã®åˆ†å‰²ä¾‹

```
è¨“ç·´æœŸé–“å…¨ä½“: 2021-01-01 ï½ 2023-01-01 (24ãƒ¶æœˆ)
å°†æ¥çª“: 0-3m (future_window_end_months=3)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è¨“ç·´æœŸé–“å…¨ä½“ï¼ˆ24ãƒ¶æœˆï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç‰¹å¾´é‡è¨ˆç®—æœŸé–“ï¼ˆ21ãƒ¶æœˆï¼‰  â”‚ ãƒ©ãƒ™ãƒ«è¨ˆç®—æœŸé–“ï¼ˆ3ãƒ¶æœˆï¼‰â”‚
â”‚  2021-01 ï½ 2022-10       â”‚  2022-10 ï½ 2023-01  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†‘                         â†‘
    ã“ã®æœŸé–“ã®æ´»å‹•ã§          ã“ã®æœŸé–“ã«æ‰¿è«¾ã—ãŸã‹
    ç‰¹å¾´é‡ã‚’è¨ˆç®—              ã©ã†ã‹ã§ãƒ©ãƒ™ãƒ«ä»˜ã‘

train_end (2023-01-01) ã‚’è¶…ãˆãªã„ âœ“
ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãªã— âœ“
```

#### å…·ä½“çš„ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼

```python
# 1. è¨“ç·´æœŸé–“å…¨ä½“ã‚’ç‰¹å¾´é‡è¨ˆç®—ã«ä½¿ç”¨
history_start = train_start          # 2021-01-01
history_end = train_end               # 2023-01-01

# 2. ãƒ©ãƒ™ãƒ«è¨ˆç®—ã¯train_endæ™‚ç‚¹ã‹ã‚‰å°†æ¥çª“ã‚’è¦‹ã‚‹
label_start = train_end + pd.DateOffset(months=0)  # 2023-01-01
label_end = train_end + pd.DateOffset(months=3)    # 2023-04-01

# âš ï¸ æ³¨æ„: label_endãŒtrain_endã‚’è¶…ãˆã¦ã„ã‚‹ï¼
# â†’ ã“ã‚Œã¯è¨“ç·´æ™‚ã®å†…éƒ¨ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
# â†’ æœ€çµ‚è©•ä¾¡ã§ã¯ä½¿ç”¨ã—ãªã„
```

#### å®Ÿè£…ã®é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼ˆ98-112è¡Œç›®ï¼‰

```python
"""
è¨“ç·´ï¼šè¨“ç·´æœŸé–“å†…ã§å®Œçµ
- ç‰¹å¾´é‡è¨ˆç®—æœŸé–“: train_start ï½ train_end
- ãƒ©ãƒ™ãƒ«è¨ˆç®—æœŸé–“: train_end ï½ train_end + future_window

âš ï¸ å•é¡Œ: ã“ã‚Œã ã¨train_endã‚’è¶…ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã—ã¦ã—ã¾ã†

è§£æ±ºç­–ï¼ˆå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼‰:
- æœˆæ¬¡ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨
- å„æœˆæœ«æ™‚ç‚¹ã‹ã‚‰ã®å°†æ¥çª“ã§ãƒ©ãƒ™ãƒ«è¨ˆç®—
- è¨“ç·´æœŸé–“ã®æœ€å¾Œã®æœˆã¯é™¤å¤–ã•ã‚Œã‚‹
"""
```

---

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: æœ€çµ‚è©•ä¾¡ï¼ˆè©•ä¾¡æœŸé–“ï¼‰

**ã‚³ãƒ¼ãƒ‰**: `train_irl_review_acceptance.py:368-450`

```python
def extract_evaluation_trajectories(
    df: pd.DataFrame,
    cutoff_date: pd.Timestamp,  # â† è¨“ç·´çµ‚äº†æ—¥
    history_window_months: int = 12,
    future_window_start_months: int = 0,
    future_window_end_months: int = 3,
    ...
):
    """
    è©•ä¾¡ç”¨è»Œè·¡ã‚’æŠ½å‡ºï¼ˆã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç‰¹å¾´é‡ç”¨ï¼‰

    Args:
        cutoff_date: Cutoffæ—¥ï¼ˆé€šå¸¸ã¯è¨“ç·´çµ‚äº†æ—¥ï¼‰
        ...
    """
    # å±¥æ­´æœŸé–“
    history_start = cutoff_date - pd.DateOffset(months=history_window_months)
    history_end = cutoff_date

    # è©•ä¾¡æœŸé–“ï¼ˆcutoffæ—¥ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿ï¼‰
    eval_start = cutoff_date + pd.DateOffset(months=future_window_start_months)
    eval_end = cutoff_date + pd.DateOffset(months=future_window_end_months)
```

#### è©•ä¾¡æœŸé–“ã®è¨­å®šä¾‹

```
Cutoffæ—¥: 2023-01-01ï¼ˆè¨“ç·´çµ‚äº†æ—¥ï¼‰
å±¥æ­´ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦: 12ãƒ¶æœˆ
å°†æ¥çª“: 0-3m

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨“ç·´æœŸé–“       â”‚  Cutoff      â”‚  è©•ä¾¡æœŸé–“        â”‚
â”‚  ï½2023-01-01   â”‚  2023-01-01  â”‚  2023-01ï½04    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘                â†‘
                  ã“ã®æ™‚ç‚¹ã¾ã§ã®    ã“ã®æœŸé–“ã®æ´»å‹•ã§
                  æ´»å‹•ã§ç‰¹å¾´é‡è¨ˆç®—   ãƒ©ãƒ™ãƒ«è¨ˆç®—

æ™‚ç³»åˆ—çš„ã«å®Œå…¨åˆ†é›¢ âœ“
æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§çœŸã®æ±åŒ–æ€§èƒ½æ¸¬å®š âœ“
```

#### å‡¦ç†ã®æµã‚Œ

```python
# 1. å±¥æ­´æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã§ç‰¹å¾´é‡è¨ˆç®—
history_df = df[
    (df['request_time'] >= history_start) &  # 2022-01-01
    (df['request_time'] < history_end)       # 2023-01-01ï¼ˆæœªæº€ï¼‰
]

# 2. è©•ä¾¡æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã§ãƒ©ãƒ™ãƒ«è¨ˆç®—
eval_df = df[
    (df['request_time'] >= eval_start) &     # 2023-01-01
    (df['request_time'] < eval_end)          # 2023-04-01ï¼ˆæœªæº€ï¼‰
]

# âœ“ history_endã¨eval_startãŒä¸€è‡´
# âœ“ æ™‚ç³»åˆ—çš„ã«é‡è¤‡ãªã—
# âœ“ ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãªã—
```

---

## ğŸ¯ è³ªå•ã¸ã®ç›´æ¥çš„ãªå›ç­”

### Q: è¨“ç·´æœŸé–“å†…ã§AUC-ROCã‚’æ¸¬ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ

**A: è¨“ç·´æ™‚ã¨è©•ä¾¡æ™‚ã§ç•°ãªã‚Šã¾ã™**

#### è¨“ç·´æ™‚ï¼ˆãƒ¢ãƒ‡ãƒ«å­¦ç¿’ä¸­ï¼‰

```python
# è¨“ç·´æœŸé–“å†…ã§ã®å†…éƒ¨ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
train_period = "2021-01-01 ï½ 2023-01-01"

# æœˆæ¬¡ãƒ©ãƒ™ãƒ«ä½¿ç”¨
# å„æœˆæœ«æ™‚ç‚¹ã‹ã‚‰å°†æ¥çª“ã‚’è¦‹ã¦ãƒ©ãƒ™ãƒ«è¨ˆç®—
for month in months_in_train_period:
    month_end = end_of_month(month)
    label_window = [month_end, month_end + 3months]

    # ã“ã®å°†æ¥çª“ãŒè¨“ç·´æœŸé–“ã‚’è¶…ãˆã‚‹æœˆã¯é™¤å¤–
    if label_window.end > train_end:
        continue  # ã‚¹ã‚­ãƒƒãƒ—
```

**çµæœ**: è¨“ç·´æœŸé–“å†…ã§å®Œçµã™ã‚‹ãƒ©ãƒ™ãƒ«ã®ã¿ä½¿ç”¨

#### æœ€çµ‚è©•ä¾¡æ™‚

```python
# Cutoffæ—¥ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§è©•ä¾¡
cutoff_date = "2023-01-01"  # è¨“ç·´çµ‚äº†æ—¥
eval_period = "2023-01-01 ï½ 2023-04-01"  # å°†æ¥çª“

# ã“ã®æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã¯è¨“ç·´ã«ä¸€åˆ‡ä½¿ç”¨ã—ã¦ã„ãªã„
# â†’ çœŸã®æ±åŒ–æ€§èƒ½ã‚’æ¸¬å®š
```

**çµæœ**: è¨“ç·´æœŸé–“å¤–ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§è©•ä¾¡

---

## ğŸ“ˆ å®Ÿéš›ã®è©•ä¾¡æ–¹æ³•

### ã‚¯ãƒ­ã‚¹è©•ä¾¡ã®å…¨ä½“åƒ

æœ¬ç ”ç©¶ã§ã¯ã€**4ã¤ã®è¨“ç·´ãƒ©ãƒ™ãƒ« Ã— 4ã¤ã®è©•ä¾¡æœŸé–“ = 16è©•ä¾¡**ã‚’å®Ÿæ–½ï¼š

```
è¨“ç·´ãƒ©ãƒ™ãƒ« â†“ / è©•ä¾¡æœŸé–“ â†’  | 0-3m  | 3-6m  | 6-9m  | 9-12m
---------------------------|-------|-------|-------|-------
0-3m ã§è¨“ç·´                | AUC1  | AUC2  | AUC3  | AUC4
3-6m ã§è¨“ç·´                | AUC5  | AUC6  | AUC7  | AUC8
6-9m ã§è¨“ç·´                | AUC9  | AUC10 | AUC11 | AUC12
9-12m ã§è¨“ç·´               | AUC13 | AUC14 | AUC15 | AUC16
```

#### å„ã‚»ãƒ«ã®è¨ˆç®—æ–¹æ³•

**ä¾‹: è¨“ç·´ãƒ©ãƒ™ãƒ«0-3m Ã— è©•ä¾¡æœŸé–“6-9m**

```python
# ã‚¹ãƒ†ãƒƒãƒ—1: è¨“ç·´ï¼ˆ0-3mãƒ©ãƒ™ãƒ«ã§å­¦ç¿’ï¼‰
train_period = "2021-01-01 ï½ 2023-01-01"
train_label_window = "0-3m"  # å„æœˆæœ«ã‹ã‚‰0-3ãƒ¶æœˆå¾Œã®æ´»å‹•

# è¨“ç·´ãƒ‡ãƒ¼ã‚¿ä½œæˆ
for month in train_period:
    month_end = end_of_month(month)
    label_start = month_end + 0
    label_end = month_end + 3

    # è¨“ç·´æœŸé–“å†…ã®ã¿ä½¿ç”¨
    if label_end <= train_end:
        label = has_activity_in(label_start, label_end)
        train_samples.append((features, label))

# ãƒ¢ãƒ‡ãƒ«è¨“ç·´
model.train(train_samples)

# ã‚¹ãƒ†ãƒƒãƒ—2: è©•ä¾¡ï¼ˆ6-9mæœŸé–“ã§è©•ä¾¡ï¼‰
cutoff_date = "2023-01-01"
eval_label_window = "6-9m"

# è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ä½œæˆ
history = get_history(cutoff_date - 12months, cutoff_date)
eval_label_start = cutoff_date + 6  # 2023-07-01
eval_label_end = cutoff_date + 9    # 2023-10-01

# çœŸã®ãƒ©ãƒ™ãƒ«: 2023-07 ï½ 2023-10 ã®æ´»å‹•æœ‰ç„¡
true_label = has_activity_in(eval_label_start, eval_label_end)

# äºˆæ¸¬
prediction = model.predict(history)

# AUC-ROCè¨ˆç®—
auc_roc = compute_auc(predictions, true_labels)
```

**é‡è¦**:
- è¨“ç·´: 0-3mãƒ©ãƒ™ãƒ«ã§å­¦ç¿’ï¼ˆè¨“ç·´æœŸé–“å†…ï¼‰
- è©•ä¾¡: 6-9mæœŸé–“ã§è©•ä¾¡ï¼ˆè©•ä¾¡æœŸé–“ã€æœªæ¥ãƒ‡ãƒ¼ã‚¿ï¼‰
- **ç•°ãªã‚‹æ™‚é–“çª“ã§ã‚‚æ±åŒ–ã§ãã‚‹ã‹**ã‚’ãƒ†ã‚¹ãƒˆ

---

## âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢ç­–

### 1. æ™‚ç³»åˆ—çš„ãªåˆ†é›¢

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  è¨“ç·´æœŸé–“     â”‚   è©•ä¾¡æœŸé–“ï¼ˆæœªæ¥ï¼‰
  ï½2023-01-01 â”‚   2023-01-01ï½
â”â”â”â”â”â”â”â”â”â”â”â”â”â”·â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
              â†‘
          Cutoffæ—¥
          ã“ã®æ—¥ä»˜ã‚’è¶…ãˆã‚‹æƒ…å ±ã¯
          è¨“ç·´ã«ä¸€åˆ‡ä½¿ç”¨ã—ãªã„
```

### 2. ç‰¹å¾´é‡è¨ˆç®—ã®å³å¯†æ€§

```python
# âœ“ æ­£ã—ã„å®Ÿè£…
def extract_features(cutoff_date):
    history = get_data(start, cutoff_date)  # cutoffæ—¥æœªæº€
    features = compute_features(history)
    return features

# âœ— ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã®ä¾‹ï¼ˆæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯è¡Œã£ã¦ã„ãªã„ï¼‰
def extract_features_with_leak(cutoff_date):
    history = get_data(start, cutoff_date + 1day)  # cutoffæ—¥ã‚’è¶…ãˆã‚‹
    features = compute_features(history)  # æœªæ¥æƒ…å ±ã‚’ä½¿ç”¨
    return features
```

### 3. ãƒ©ãƒ™ãƒ«è¨ˆç®—ã®åˆ†é›¢

```python
# è¨“ç·´æ™‚
train_labels = compute_labels(
    data=train_data,  # è¨“ç·´æœŸé–“å†…ã®ã¿
    max_date=train_end  # ã“ã®æ—¥ä»˜ã‚’è¶…ãˆãªã„
)

# è©•ä¾¡æ™‚
eval_labels = compute_labels(
    data=eval_data,  # cutoffæ—¥ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿
    start_date=cutoff_date,
    end_date=cutoff_date + eval_window
)
```

---

## ğŸ”¬ å®Ÿè£…ã®æ¤œè¨¼

### ã‚³ãƒ¼ãƒ‰å†…ã®é‡è¦ãªã‚³ãƒ¡ãƒ³ãƒˆ

**è¨“ç·´æ™‚ï¼ˆ98-112è¡Œç›®ï¼‰**:
```python
"""
é‡è¦ï¼šè¨“ç·´æœŸé–“å†…ã§å®Œçµã•ã›ã‚‹ãŸã‚ã€è¨“ç·´æœŸé–“ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†å‰²ï¼š
- **ç‰¹å¾´é‡è¨ˆç®—æœŸé–“**: train_start ï½ (train_end - future_window_end_months)
- **ãƒ©ãƒ™ãƒ«è¨ˆç®—æœŸé–“**: ç‰¹å¾´é‡è¨ˆç®—æœŸé–“çµ‚äº†å¾Œ ï½ train_end

ã“ã‚Œã«ã‚ˆã‚Šã€è¨“ç·´æœŸé–“ï¼ˆtrain_endï¼‰ã‚’è¶…ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã›ãšã«ãƒ©ãƒ™ãƒ«ä»˜ã‘ãŒå¯èƒ½ã€‚
"""
```

**è©•ä¾¡æ™‚ï¼ˆ385-387è¡Œç›®ï¼‰**:
```python
"""
Args:
    cutoff_date: Cutoffæ—¥ï¼ˆé€šå¸¸ã¯è¨“ç·´çµ‚äº†æ—¥ï¼‰
    ...
"""
```

### ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

âœ… **è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã®æ™‚ç³»åˆ—åˆ†é›¢**
```python
assert all(train_data['date'] < cutoff_date)
assert all(eval_data['date'] >= cutoff_date)
```

âœ… **ç‰¹å¾´é‡è¨ˆç®—æ™‚ã®æ—¥ä»˜åˆ¶é™**
```python
def extract_features(data, cutoff_date):
    # cutoffæ—¥æœªæº€ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ä½¿ç”¨
    filtered_data = data[data['date'] < cutoff_date]
    return compute_features(filtered_data)
```

âœ… **ãƒ©ãƒ™ãƒ«è¨ˆç®—æ™‚ã®æœŸé–“åˆ†é›¢**
```python
# è¨“ç·´: è¨“ç·´æœŸé–“å†…
train_labels = compute_labels(data, train_start, train_end)

# è©•ä¾¡: cutoffæ—¥ä»¥é™
eval_labels = compute_labels(data, cutoff_date, cutoff_date + window)
```

---

## ğŸ“Š è©•ä¾¡çµæœã®è§£é‡ˆ

### å ±å‘Šã•ã‚Œã¦ã„ã‚‹AUC-ROC

**ä¾‹: AUC-ROCè¡Œåˆ—**

| è¨“ç·´ â†“ / è©•ä¾¡ â†’ | 0-3m | 3-6m | 6-9m | 9-12m |
|----------------|------|------|------|-------|
| **0-3m** | 0.717 | 0.823 | **0.910** | 0.734 |

**ã“ã®0.910ã®æ„å‘³**:

```
è¨“ç·´:
  - æœŸé–“: 2021-01 ï½ 2023-01
  - ãƒ©ãƒ™ãƒ«: å„æœˆæœ«ã‹ã‚‰0-3ãƒ¶æœˆå¾Œã®æ´»å‹•ï¼ˆè¨“ç·´æœŸé–“å†…ï¼‰
  - ã‚µãƒ³ãƒ—ãƒ«: ç´„200ä»¶

è©•ä¾¡:
  - Cutoff: 2023-01-01
  - å±¥æ­´: 2022-01 ï½ 2023-01ï¼ˆ12ãƒ¶æœˆï¼‰
  - ãƒ©ãƒ™ãƒ«: 2023-07 ï½ 2023-10ï¼ˆ6-9ãƒ¶æœˆå¾Œï¼‰
  - ã‚µãƒ³ãƒ—ãƒ«: ç´„50ä»¶

â†’ è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã§è¦‹ãŸã“ã¨ã®ãªã„
  ã€Œ6-9ãƒ¶æœˆå¾Œã®ç¶™ç¶šã€ã‚’91%ã®ç²¾åº¦ã§äºˆæ¸¬
â†’ çœŸã®æ±åŒ–æ€§èƒ½ã‚’ç¤ºã—ã¦ã„ã‚‹ âœ“
```

---

## ğŸ“ ç™ºè¡¨ã§ã®èª¬æ˜ï¼ˆæ¨å¥¨ï¼‰

### 30ç§’ç‰ˆ

```
ã€Œæœ¬ç ”ç©¶ã§ã¯ã€æ™‚ç³»åˆ—çš„ã«å³å¯†ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚

è¨“ç·´æ™‚ã¯2021-2023å¹´ã®ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’ã—ã€
è©•ä¾¡æ™‚ã¯2023å¹´ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§æ€§èƒ½ã‚’æ¸¬å®šã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œãªã„
æœªæ¥ã®æƒ…å ±ã§çœŸã®æ±åŒ–æ€§èƒ½ã‚’è©•ä¾¡ã—ã¦ãŠã‚Šã€
ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“ã€‚ã€
```

### è©³ç´°ç‰ˆï¼ˆè³ªå•ã¸ã®å›ç­”ï¼‰

```
Q: è¨“ç·´æœŸé–“å†…ã§AUC-ROCã‚’æ¸¬ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ

A: ã„ã„ãˆã€è¨“ç·´ã¨è©•ä¾¡ã¯æ˜ç¢ºã«åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚

è¨“ç·´æ™‚:
- 2021-2023å¹´ã®ãƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’
- æœˆæ¬¡ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨ï¼ˆè¨“ç·´æœŸé–“å†…ã§å®Œçµï¼‰

è©•ä¾¡æ™‚:
- Cutoffæ—¥ï¼ˆ2023-01-01ï¼‰ä»¥é™ã®æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§è©•ä¾¡
- å±¥æ­´: Cutoffæ—¥ã¾ã§ã®12ãƒ¶æœˆ
- ãƒ©ãƒ™ãƒ«: Cutoffæ—¥ã‹ã‚‰6-9ãƒ¶æœˆå¾Œã®æ´»å‹•
- ã“ã®æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã¯è¨“ç·´ã«ä¸€åˆ‡ä½¿ç”¨ã—ã¦ã„ãªã„

çµæœ: AUC-ROC 0.910ã¯çœŸã®æ±åŒ–æ€§èƒ½ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
```

---

## ğŸ“š ã¾ã¨ã‚

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

1. **è¨“ç·´ã¨è©•ä¾¡ã¯æ™‚ç³»åˆ—çš„ã«å®Œå…¨åˆ†é›¢**
   - è¨“ç·´: 2021-2023
   - è©•ä¾¡: 2023ä»¥é™ï¼ˆæœªæ¥ãƒ‡ãƒ¼ã‚¿ï¼‰

2. **è¨“ç·´æœŸé–“å†…ã§ã®è©•ä¾¡ã¯å†…éƒ¨ã‚¯ãƒ­ã‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿**
   - æœˆæ¬¡ãƒ©ãƒ™ãƒ«ä½¿ç”¨
   - è¨“ç·´æœŸé–“ã‚’è¶…ãˆãªã„ã‚ˆã†è¨­è¨ˆ

3. **æœ€çµ‚è©•ä¾¡ã¯æœªæ¥ãƒ‡ãƒ¼ã‚¿ã§å®Ÿæ–½**
   - Cutoffæ—¥ä»¥é™ã®ãƒ‡ãƒ¼ã‚¿
   - çœŸã®æ±åŒ–æ€§èƒ½ã‚’æ¸¬å®š

4. **ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãªã—**
   - ç‰¹å¾´é‡: Cutoffæ—¥æœªæº€
   - ãƒ©ãƒ™ãƒ«: Cutoffæ—¥ä»¥é™
   - æ™‚ç³»åˆ—çš„ã«é‡è¤‡ãªã—

### ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é˜²æ­¢ã®è¨¼æ˜

```python
# è¨“ç·´ãƒ‡ãƒ¼ã‚¿
train_features = extract_features(data, max_date=train_end)
train_labels = extract_labels(data, train_start, train_end)

# è©•ä¾¡ãƒ‡ãƒ¼ã‚¿
eval_features = extract_features(data, max_date=cutoff_date)
eval_labels = extract_labels(data, cutoff_date + 6m, cutoff_date + 9m)

# æ¤œè¨¼
assert train_end <= cutoff_date  # è¨“ç·´çµ‚äº† â‰¤ è©•ä¾¡é–‹å§‹
assert cutoff_date + 6m > cutoff_date  # è©•ä¾¡ãƒ©ãƒ™ãƒ«ã¯æœªæ¥
```

---

**å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«**:
- `scripts/training/irl/train_irl_review_acceptance.py`
  - Line 84-228: è¨“ç·´ç”¨è»Œè·¡æŠ½å‡º
  - Line 368-450: è©•ä¾¡ç”¨è»Œè·¡æŠ½å‡º

**æœ€çµ‚æ›´æ–°**: 2025-11-17
