# 4×4行列評価サマリー（学習期間×予測期間）

## 評価設定

**2023 Q1スナップショット (2023-01-01)の結果**

- **固定対象レビュアー数**: 291人（全16実験で同一）
- **学習期間**: 3, 6, 9, 12ヶ月
- **予測期間**: 3, 6, 9, 12ヶ月
- **総実験数**: 16（4×4）
- **シーケンス長**: 15
- **エポック数**: 30

## AUC-ROC 行列（2023 Q1）

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月  0.804   0.843   0.835   0.863
習 6ヶ月  0.900   0.883   0.869   0.862
期 9ヶ月  0.812   0.818   0.731   0.702
間 12ヶ月 0.817   0.817   0.721   0.740
```

### 重要な発見

#### 1. 最良の組み合わせ
- **最高AUC-ROC**: 6ヶ月学習 × 3ヶ月予測 = **0.900**
- 6ヶ月学習が最も安定して高性能
- 短期予測（3ヶ月）が最も精度が高い

#### 2. 学習期間の効果

| 学習期間 | 平均AUC-ROC | 最良予測期間 | 最高値 |
|---------|------------|------------|--------|
| 3ヶ月   | 0.836      | 12ヶ月     | 0.863  |
| **6ヶ月** | **0.879** | **3ヶ月**  | **0.900** |
| 9ヶ月   | 0.766      | 6ヶ月      | 0.818  |
| 12ヶ月  | 0.774      | 6ヶ月      | 0.817  |

**結論**: 6ヶ月学習が最適（平均0.879）。9ヶ月・12ヶ月は過学習の可能性。

#### 3. 予測期間の効果

| 予測期間 | 平均AUC-ROC | 最良学習期間 | 最高値 |
|---------|------------|------------|--------|
| **3ヶ月** | **0.833** | **6ヶ月**  | **0.900** |
| 6ヶ月   | 0.840      | 6ヶ月      | 0.883  |
| 9ヶ月   | 0.789      | 6ヶ月      | 0.869  |
| 12ヶ月  | 0.792      | 6ヶ月      | 0.863  |

**結論**: 短期予測（3ヶ月）が最も高精度。長期になるほど難易度上昇。

## AUC-PR 行列（2023 Q1）

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月  0.928   0.948   0.944   0.963
習 6ヶ月  0.957   0.954   0.952   0.961
期 9ヶ月  0.902   0.922   0.901   0.912
間 12ヶ月 0.908   0.918   0.899   0.922
```

### 重要な発見

- **最高AUC-PR**: 3ヶ月学習 × 12ヶ月予測 = **0.963**
- AUC-PRではすべての組み合わせが0.9以上と非常に高い
- 3ヶ月・6ヶ月学習が優秀（平均0.94以上）

## F1スコア 行列（2023 Q1）

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月  0.848   0.866   0.866   0.882
習 6ヶ月  0.828   0.868   0.840   0.712
期 9ヶ月  0.722   0.740   0.676   0.725
間 12ヶ月 0.732   0.696   0.685   0.741
```

### 重要な発見

- **最高F1**: 3ヶ月学習 × 12ヶ月予測 = **0.882**
- 3ヶ月学習が最も安定（平均0.866）
- 9ヶ月・12ヶ月学習は性能低下（平均0.7前後）

## Precision 行列（2023 Q1）

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月  0.737   0.763   0.763   0.789
習 6ヶ月  0.750   0.943   0.895   0.963
期 9ヶ月  0.788   0.844   0.806   0.853
間 12ヶ月 0.813   0.857   0.833   0.857
```

### 重要な発見

- **最高Precision**: 6ヶ月学習 × 12ヶ月予測 = **0.963**
- 6ヶ月学習の長期予測で非常に高いprecision
- False Positiveが非常に少ない

## Recall 行列（2023 Q1）

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月  1.000   1.000   1.000   1.000
習 6ヶ月  0.923   0.805   0.791   0.565
期 9ヶ月  0.667   0.659   0.581   0.630
間 12ヶ月 0.667   0.585   0.581   0.652
```

### 重要な発見

- **最高Recall**: 3ヶ月学習 × 全予測期間 = **1.000**
- 3ヶ月学習は継続者を全て検出（false negative なし）
- ただし、precisionが低い（0.74-0.79）= false positiveが多い
- **トレードオフ**:
  - 3ヶ月学習: 高recall、低precision（安全側）
  - 6ヶ月学習: バランス型
  - 長期学習: 高precision、低recall（保守的）

## サンプル数の確認

```
             予測期間
         3ヶ月   6ヶ月   9ヶ月   12ヶ月
学 3ヶ月   152    152    152    152
習 6ヶ月   232    232    232    232
期 9ヶ月   232    232    232    232
間 12ヶ月  232    232    232    232
```

**注意**: 3ヶ月学習期間のサンプル数が152と少ない（101人が活動なしでスキップ）

## 総合評価

### 推奨組み合わせ（用途別）

#### 1. 最高精度重視
- **6ヶ月学習 × 3ヶ月予測**
- AUC-ROC: 0.900, AUC-PR: 0.957
- バランスの取れた高性能

#### 2. 網羅性重視（継続者を逃したくない）
- **3ヶ月学習 × 任意の予測期間**
- Recall: 1.000（全継続者を検出）
- ただしFalse Positive多い

#### 3. 正確性重視（誤報を減らしたい）
- **6ヶ月学習 × 12ヶ月予測** または **9-12ヶ月学習 × 6-12ヶ月予測**
- Precision: 0.85-0.96
- ただしRecall低い

#### 4. 実用バランス型
- **6ヶ月学習 × 6ヶ月予測**
- AUC-ROC: 0.883, F1: 0.868, Precision: 0.943, Recall: 0.805
- 全メトリクスで高水準

### 学習期間別の特性

| 学習期間 | 特徴 | 適用場面 |
|---------|-----|---------|
| 3ヶ月 | 高recall、低precision、データ不足 | 初期スクリーニング |
| **6ヶ月** | **最もバランスが良い、最高精度** | **標準推奨** |
| 9ヶ月 | 性能低下、過学習の兆候 | 非推奨 |
| 12ヶ月 | やや低性能、古いデータの影響 | コミュニティ低活動時のみ |

### 予測期間別の特性

| 予測期間 | 特徴 | 適用場面 |
|---------|-----|---------|
| **3ヶ月** | **最高精度、実用的** | **短期施策立案** |
| 6ヶ月 | バランス良好 | 中期計画 |
| 9ヶ月 | やや難易度高い | - |
| 12ヶ月 | 精度やや低下 | 長期トレンド |

## 他の四半期との比較（予定）

現在、以下の四半期でも同じ4×4評価を実行中：
- 2022 Q2 (2022-04-01): 343人
- 2022 Q3 (2022-07-01): 320人
- 2022 Q4 (2022-10-01): 306人

完了後、時系列での最適組み合わせの変化を分析予定。

## 実装への示唆

### 1. デフォルト設定
```python
DEFAULT_HISTORY_MONTHS = 6
DEFAULT_TARGET_MONTHS = 3
```

### 2. 適応的設定
```python
def select_optimal_config(community_activity_level, use_case):
    if use_case == "screening":
        return (3, 3)  # High recall
    elif use_case == "precision":
        return (6, 12)  # High precision
    else:  # balanced
        return (6, 6)  # Recommended default
```

### 3. アンサンブル可能性
3ヶ月・6ヶ月学習のアンサンブルで、recall/precisionのトレードオフを調整可能。

---

作成日: 2025-10-17
スナップショット: 2023-01-01
実験数: 16（4×4）
対象レビュアー: 291人（固定）
