# レビュー承諾予測 IRL モデル - 総合分析レポート

## 📊 概要

OpenStack Nova プロジェクトのレビュー依頼データを用いた IRL（逆強化学習）モデルによる、レビュアーの承諾予測モデルの性能評価と特徴量分析。

### 評価期間

- **訓練期間**: 2021-01-01 ～ 2023-01-01（24 ヶ月）
- **評価期間**: 2023-01-01 ～ 2024-01-01（12 ヶ月）
- **訓練期間**: 0-3m, 3-6m, 6-9m, 9-12m
- **評価期間**: 0-3m, 3-6m, 6-9m, 9-12m

### 特徴量

#### 状態特徴量（10 次元）

1. 経験日数
2. 総コミット数
3. 総レビュー数
4. 最近の活動頻度
5. 平均活動間隔
6. 活動トレンド
7. 協力スコア
8. コード品質スコア
9. 最近の受諾率
10. レビュー負荷

#### 行動特徴量（4 次元）

1. 強度（ファイル数）
2. 協力度
3. 応答速度
4. レビュー規模（行数）

---

## 1. モデル性能

### 1.1 訓練データでの性能

| メトリクス | 平均      |
| ---------- | --------- |
| AUC-ROC    | **0.762** |
| AUC-PR     | **0.663** |
| F1 Score   | **0.671** |

### 1.2 評価データでの性能（対角線）

| メトリクス | 平均      |
| ---------- | --------- |
| AUC-ROC    | **0.754** |
| AUC-PR     | **0.656** |
| F1 Score   | **0.636** |

### 1.3 オーバーフィッティング度合い

- **AUC-ROC 差**: +0.009
- **F1 差**: +0.035

**結論**: 汎化性能が**優秀**（AUC-ROC 差 < 0.01）

---

## 2. 期間別性能

### 訓練期間別の性能（対角線評価）

| 期間  | 訓練 AUC-ROC | 評価 AUC-ROC | 評価 AUC-PR | F1        |
| ----- | ------------ | ------------ | ----------- | --------- |
| 0-3m  | 0.723        | 0.717        | 0.579       | 0.591     |
| 3-6m  | **0.818**    | **0.820**    | **0.766**   | **0.645** |
| 6-9m  | 0.785        | 0.785        | 0.742       | 0.581     |
| 9-12m | 0.723        | 0.693        | 0.536       | 0.727     |

**発見**:

- **3-6m**が最高の性能（AUC-ROC 0.820, AUC-PR 0.766）
- **9-12m**で Recall=1.0 の問題（分布シフトの影響）

---

## 3. 特徴量重要度分析

### 3.1 状態特徴量重要度（平均）

| 順位 | 特徴量           | 重要度      |
| ---- | ---------------- | ----------- |
| 1    | **総レビュー数** | **+0.0165** |
| 2    | 平均活動間隔     | **-0.0107** |
| 3    | 総コミット数     | +0.0080     |
| 4    | コード品質スコア | -0.0078     |
| 5    | 最近の活動頻度   | +0.0076     |
| 6    | 協力スコア       | +0.0041     |
| 7    | レビュー負荷     | +0.0011     |
| 8    | 最近の受諾率     | -0.0001     |
| 9    | 経験日数         | -0.0026     |
| 10   | 活動トレンド     | -0.0064     |

### 3.2 行動特徴量重要度（平均）

| 順位 | 特徴量               | 重要度      |
| ---- | -------------------- | ----------- |
| 1    | **協力度**           | **+0.0131** |
| 2    | 強度（ファイル数）   | +0.0083     |
| 3    | レビュー規模（行数） | -0.0034     |
| 4    | 応答速度             | +0.0027     |

### 3.3 特徴量重要度の時系列推移

訓練期間による特徴量重要度の変化を可視化。

**主要な発見**:

- **総レビュー数**: 全ての期間で最高の重要度
- **協力度**: 行動特徴量で最も重要な指標
- **平均活動間隔**: 負の重要度（間隔が長いほど離脱しやすい）

詳細は以下を参照:

- `heatmaps/feature_importance_transition.png`: ヒートマップ
- `heatmaps/feature_importance_timeseries.png`: 時系列グラフ
- `heatmaps/action_importance_timeseries.png`: 行動特徴量の時系列

---

## 4. 可視化一覧

### 4.1 ヒートマップ

- **`heatmap_4_metrics.png`**: 4 つのメトリクス（Precision, Recall, F1, AUC-ROC）
- **`heatmap_combined.png`**: AUC-ROC と F1 の統合
- **`heatmap_AUC_ROC.png`**: AUC-ROC
- **`heatmap_AUC_PR.png`**: AUC-PR
- **`heatmap_Precision.png`**: Precision
- **`heatmap_Recall.png`**: Recall

### 4.2 特徴量分析

- **`feature_importance_transition.png`**: 特徴量重要度の推移（ヒートマップ）
- **`feature_importance_timeseries.png`**: 状態特徴量の時系列
- **`action_importance_timeseries.png`**: 行動特徴量の時系列
- **`train_vs_eval_performance.png`**: 訓練データ vs 評価データの性能比較

### 4.3 開発者タイプ別分析

- **`developer_type_analysis/experience_level_analysis.png`**: 経験レベル別
- **`developer_type_analysis/acceptance_level_analysis.png`**: 受諾率レベル別
- **`developer_type_analysis/prediction_probability_distribution.png`**: 予測確率分布
- **`developer_type_analysis/experience_acceptance_2d_heatmap.png`**: 2 次元ヒートマップ

---

## 5. 主要な発見

### 5.1 モデル性能

✅ **優秀な汎化性能**

- 訓練データと評価データの差が小さい（AUC-ROC 差: 0.009）
- 平均 AUC-PR 0.656 は実用的な性能

✅ **3-6m 期間が最高性能**

- AUC-ROC 0.820, AUC-PR 0.766
- 中期期間での予測が最も安定

⚠️ **9-12m 期間の問題**

- Recall=1.0（全サンプルを正例と予測）
- 分布シフトの影響が大きい

### 5.2 特徴量重要度

✅ **総レビュー数が最も重要**

- 経験の蓄積が継続性を示す
- すべての訓練期間で一貫して高い重要度

✅ **協力度が行動特徴量で最重要**

- チームワークが継続性に繋がる
- 単独作業よりも協働が評価される

⚠️ **平均活動間隔が負の重要度**

- 活動間隔が長いほど離脱しやすい
- 非活動期間の監視が必要

### 5.3 モデルの特性

1. **時系列学習**: 訓練時は LSTM で時系列データを学習
2. **スナップショット予測**: 評価時は集約特徴量で予測
3. **閾値最適化**: 評価データ上で F1 スコア最大化
4. **重み付きサンプリング**: 拡張期間のサンプルに重み 0.1 を適用

---

## 6. 推奨事項

### 6.1 モデル改善

1. **長時間予測の改善**:

   - 9-12m 期間での分布シフト対策
   - カリブレーション手法の適用

2. **特徴量拡張**:

   - プロジェクト横断の特徴量
   - 時間的特徴量の追加

3. **閾値決定**:
   - 訓練データで閾値を固定する試み
   - カリブレーションによる調整

### 6.2 実運用への適用

1. **モニタリング**:

   - 平均活動間隔の監視
   - 協力度の維持

2. **介入施策**:

   - 非活動期間中のエンゲージメント促進
   - 協働機会の創出

3. **個別対応**:
   - 経験レベル別のアプローチ
   - 受諾率レベル別の施策

---

## 7. 技術的詳細

### 7.1 モデル設定

- **隠れ層**: 128 ユニット
- **Dropout**: 0.2
- **学習率**: 0.0001
- **エポック数**: 20
- **シード**: 777

### 7.2 データ処理

- **最小レビュー数**: 3 件
- **重み付き負例**: 拡張期間で依頼あり → 重み 0.1
- **除外条件**: 拡張期間でも依頼なし

### 7.3 評価手法

- **クロス評価**: 4 訓練期間 × 4 評価期間 = 16 評価
- **メトリクス**: AUC-ROC, AUC-PR, Precision, Recall, F1
- **閾値決定**: 評価データ上で最適化

---

## 8. 結論

レビュー承諾予測 IRL モデルは**平均 AUC-PR 0.656**を達成し、汎化性能も良好（AUC-ROC 差 0.009）である。特に**総レビュー数**と**協力度**が重要な指標として機能している。実運用においては、非活動期間の監視と協働機会の創出が有効な介入策となる。

---

## 📁 ファイル一覧

### マトリクス CSV

- `matrix_AUC_ROC.csv`
- `matrix_AUC_PR.csv`
- `matrix_PRECISION.csv`
- `matrix_RECALL.csv`
- `matrix_F1.csv`

### ヒートマップ

- `heatmaps/heatmap_4_metrics.png` ⭐ 推奨
- `heatmaps/heatmap_combined.png`
- `heatmaps/feature_importance_transition.png` ⭐ 推奨
- その他（個別メトリクス）

### 特徴量分析

- `average_feature_importance/gradient_importance_combined.png`
- `average_feature_importance/gradient_importance_average.json`

### 各訓練期間

- `train_<期間>/optimal_threshold.json`: 訓練データの性能
- `train_<期間>/metrics.json`: 対角線評価の性能
- `train_<期間>/feature_importance/`: 特徴量重要度

---

**作成日**: 2024 年 10 月 31 日
